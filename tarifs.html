<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tarifs – Où part mon argent ?</title>
  <link rel="stylesheet" href="css/style.css?v=2">
  <style>
    .pricing-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-lg);
      margin-top: var(--space-xl);
    }
    
    .pricing-card {
      background: var(--bg-card);
      border: 2px solid var(--border-light);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      text-align: center;
      position: relative;
      transition: all var(--transition-base);
    }
    
    .pricing-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.1);
    }
    
    .pricing-card.popular {
      border-color: var(--accent);
      transform: scale(1.02);
    }
    
    .pricing-card.popular:hover {
      transform: scale(1.02) translateY(-4px);
    }
    
    .pricing-card.current {
      border-color: var(--accent);
      background: var(--accent-subtle);
    }
    
    .popular-badge {
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--accent);
      color: white;
      font-size: 11px;
      font-weight: 700;
      padding: 6px 16px;
      border-radius: var(--radius-full);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .current-badge {
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--accent);
      color: white;
      font-size: 11px;
      font-weight: 700;
      padding: 6px 16px;
      border-radius: var(--radius-full);
    }
    
    .pricing-name {
      font-size: var(--text-xl);
      font-weight: 700;
      margin-bottom: var(--space-xs);
    }
    
    .pricing-desc {
      font-size: var(--text-sm);
      color: var(--text-muted);
      margin-bottom: var(--space-lg);
    }
    
    .pricing-price {
      font-size: var(--text-4xl);
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: var(--space-xs);
    }
    
    .pricing-price span {
      font-size: var(--text-base);
      font-weight: 400;
      color: var(--text-muted);
    }
    
    .pricing-period {
      font-size: var(--text-sm);
      color: var(--text-muted);
      margin-bottom: var(--space-lg);
    }
    
    .pricing-features {
      text-align: left;
      margin-bottom: var(--space-xl);
    }
    
    .pricing-feature {
      display: flex;
      align-items: flex-start;
      gap: var(--space-sm);
      padding: var(--space-sm) 0;
      font-size: var(--text-sm);
      border-bottom: 1px solid var(--border-light);
    }
    
    .pricing-feature:last-child {
      border-bottom: none;
    }
    
    .pricing-feature-icon {
      flex-shrink: 0;
      font-size: 16px;
    }
    
    .pricing-feature.included .pricing-feature-icon {
      color: var(--accent);
    }
    
    .pricing-feature.excluded {
      color: var(--text-muted);
      text-decoration: line-through;
    }
    
    .pricing-feature.excluded .pricing-feature-icon {
      color: var(--text-muted);
    }
    
    .pricing-btn {
      width: 100%;
    }
    
    .pricing-btn.current-plan {
      background: var(--bg-subtle);
      color: var(--text-muted);
      cursor: default;
      border: 1px solid var(--border-light);
    }
    
    .pricing-btn.current-plan:hover {
      transform: none;
      box-shadow: none;
    }
    
    /* Comparaison */
    .comparison-section {
      margin-top: var(--space-3xl);
    }
    
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: var(--space-xl);
      font-size: var(--text-sm);
    }
    
    .comparison-table th,
    .comparison-table td {
      padding: var(--space-md);
      text-align: center;
      border-bottom: 1px solid var(--border-light);
    }
    
    .comparison-table th {
      background: var(--bg-subtle);
      font-weight: 600;
    }
    
    .comparison-table th:first-child,
    .comparison-table td:first-child {
      text-align: left;
    }
    
    .check {
      color: var(--accent);
      font-size: 18px;
    }
    
    .cross {
      color: var(--text-muted);
      font-size: 18px;
    }
    
    /* FAQ */
    .faq-section {
      margin-top: var(--space-3xl);
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .faq-item {
      border-bottom: 1px solid var(--border-light);
      padding: var(--space-lg) 0;
    }
    
    .faq-question {
      font-weight: 600;
      margin-bottom: var(--space-sm);
    }
    
    .faq-answer {
      color: var(--text-secondary);
      font-size: var(--text-sm);
    }
    
    /* Responsive */
    @media (max-width: 900px) {
      .pricing-grid {
        grid-template-columns: 1fr;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
      }
      
      .pricing-card.popular {
        transform: none;
        order: -1;
      }
      
      .comparison-table {
        font-size: var(--text-xs);
      }
      
      .comparison-table th,
      .comparison-table td {
        padding: var(--space-sm);
      }
    }
  </style>
</head>
<body>

<header class="header">
  <div class="brand">
    <div class="logo">€</div>
    <div>
      <div class="brand-title">Où part mon argent ?</div>
      <div class="brand-subtitle">Tarifs</div>
    </div>
  </div>

  <nav class="nav">
    <a class="nav-link" href="index.html">Accueil</a>
    <a class="nav-link" href="test.html">Test gratuit</a>
    <a class="nav-link active" href="tarifs.html">Tarifs</a>
    <a class="nav-link" href="login.html" data-auth="out">Connexion</a>
    <a class="nav-link" href="dashboard.html" data-auth="in">Dashboard</a>
    <button class="btn-ghost" type="button" data-auth="in" data-logout>Déconnexion</button>
  </nav>
</header>

<main class="container">
  <section class="hero compact">
    <h1>Des tarifs simples et transparents</h1>
    <p class="lead">Choisissez le plan qui correspond à vos besoins. Changez ou annulez à tout moment.</p>
  </section>

  <!-- GRILLE TARIFS -->
  <div class="pricing-grid">
    
    <!-- GRATUIT -->
    <div class="pricing-card" id="card-free">
      <div class="current-badge" id="badge-free" style="display: none;">✓ Plan actuel</div>
      <div class="pricing-name">Gratuit</div>
      <div class="pricing-desc">Pour découvrir</div>
      <div class="pricing-price">0€</div>
      <div class="pricing-period">pour toujours</div>
      
      <div class="pricing-features">
        <div class="pricing-feature included">
          <span class="pricing-feature-icon">✓</span>
          <span>Test budget illimité</span>
        </div>
        <div class="pricing-feature included">
          <span class="pricing-feature-icon">✓</span>
          <span>Résumé financier</span>
        </div>
        <div class="pricing-feature included">
          <span class="pricing-feature-icon">✓</span>
          <span>Historique des tests</span>
        </div>
        <div class="pricing-feature excluded">
          <span class="pricing-feature-icon">✗</span>
          <span>Objectifs d'épargne</span>
        </div>
        <div class="pricing-feature excluded">
          <span class="pricing-feature-icon">✗</span>
          <span>Suivi des abonnements</span>
        </div>
        <div class="pricing-feature excluded">
          <span class="pricing-feature-icon">✗</span>
          <span>Rappels email</span>
        </div>
      </div>
      
      <button class="btn btn-secondary pricing-btn" id="btn-free" onclick="handlePlanClick('free')">
        Commencer gratuitement
      </button>
    </div>
    
    <!-- ESSENTIEL -->
    <div class="pricing-card popular" id="card-essential">
      <div class="popular-badge" id="popular-badge-essential">Le plus populaire</div>
      <div class="current-badge" id="badge-essential" style="display: none;">✓ Plan actuel</div>
      <div class="pricing-name">Essentiel</div>
      <div class="pricing-desc">Pour mieux gérer</div>
      <div class="pricing-price">3,99€ <span>/mois</span></div>
      <div class="pricing-period">soit 47,88€/an</div>
      
      <div class="pricing-features">
        <div class="pricing-feature included">
          <span class="pricing-feature-icon">✓</span>
          <span>Tout le plan Gratuit</span>
        </div>
        <div class="pricing-feature included">
          <span class="pricing-feature-icon">✓</span>
          <span><strong>1 objectif d'épargne</strong></span>
        </div>
        <div class="pricing-feature included">
          <span class="pricing-feature-icon">✓</span>
          <span><strong>Suivi des abonnements</strong></span>
        </div>
        <div class="pricing-feature included">
          <span class="pricing-feature-icon">✓</span>
          <span><strong>Détection des fuites</strong></span>
        </div>
        <div class="pricing-feature included">
          <span class="pricing-feature-icon">✓</span>
          <span><strong>Rappel hebdomadaire</strong></span>
        </div>
        <div class="pricing-feature excluded">
          <span class="pricing-feature-icon">✗</span>
          <span>Comparateur de décisions</span>
        </div>
      </div>
      
      <button class="btn btn-primary pricing-btn" id="btn-essential" onclick="handlePlanClick('essential')">
        Choisir Essentiel
      </button>
    </div>
    
    <!-- COMPLET -->
    <div class="pricing-card" id="card-complete">
      <div class="current-badge" id="badge-complete" style="display: none;">✓ Plan actuel</div>
      <div class="pricing-name">Complet</div>
      <div class="pricing-desc">Pour optimiser</div>
      <div class="pricing-price">8,99€ <span>/mois</span></div>
      <div class="pricing-period">soit 107,88€/an</div>
      
      <div class="pricing-features">
        <div class="pricing-feature included">
          <span class="pricing-feature-icon">✓</span>
          <span>Tout le plan Essentiel</span>
        </div>
        <div class="pricing-feature included">
          <span class="pricing-feature-icon">✓</span>
          <span><strong>Objectifs illimités</strong></span>
        </div>
        <div class="pricing-feature included">
          <span class="pricing-feature-icon">✓</span>
          <span><strong>Comparateur de décisions</strong></span>
        </div>
        <div class="pricing-feature included">
          <span class="pricing-feature-icon">✓</span>
          <span><strong>Simulateur d'imprévus</strong></span>
        </div>
        <div class="pricing-feature included">
          <span class="pricing-feature-icon">✓</span>
          <span><strong>Emails personnalisés</strong></span>
        </div>
        <div class="pricing-feature included">
          <span class="pricing-feature-icon">✓</span>
          <span><strong>Support prioritaire</strong></span>
        </div>
      </div>
      
      <button class="btn btn-primary pricing-btn" id="btn-complete" onclick="handlePlanClick('complete')">
        Choisir Complet
      </button>
    </div>
    
  </div>

  <!-- COMPARAISON -->
  <section class="comparison-section">
    <h2 style="text-align: center;">Comparaison détaillée</h2>
    
    <table class="comparison-table">
      <thead>
        <tr>
          <th>Fonctionnalité</th>
          <th>Gratuit</th>
          <th>Essentiel</th>
          <th>Complet</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Test budget</td>
          <td><span class="check">✓</span></td>
          <td><span class="check">✓</span></td>
          <td><span class="check">✓</span></td>
        </tr>
        <tr>
          <td>Historique des tests</td>
          <td><span class="check">✓</span></td>
          <td><span class="check">✓</span></td>
          <td><span class="check">✓</span></td>
        </tr>
        <tr>
          <td>Dashboard résumé</td>
          <td><span class="check">✓</span></td>
          <td><span class="check">✓</span></td>
          <td><span class="check">✓</span></td>
        </tr>
        <tr>
          <td>Objectifs d'épargne</td>
          <td><span class="cross">✗</span></td>
          <td>1 objectif</td>
          <td>Illimités</td>
        </tr>
        <tr>
          <td>Suivi des abonnements</td>
          <td><span class="cross">✗</span></td>
          <td><span class="check">✓</span></td>
          <td><span class="check">✓</span></td>
        </tr>
        <tr>
          <td>Détection des fuites</td>
          <td><span class="cross">✗</span></td>
          <td><span class="check">✓</span></td>
          <td><span class="check">✓</span></td>
        </tr>
        <tr>
          <td>Rappels email</td>
          <td><span class="cross">✗</span></td>
          <td>Hebdomadaire</td>
          <td>Personnalisés</td>
        </tr>
        <tr>
          <td>Comparateur de décisions</td>
          <td><span class="cross">✗</span></td>
          <td><span class="cross">✗</span></td>
          <td><span class="check">✓</span></td>
        </tr>
        <tr>
          <td>Simulateur d'imprévus</td>
          <td><span class="cross">✗</span></td>
          <td><span class="cross">✗</span></td>
          <td><span class="check">✓</span></td>
        </tr>
        <tr>
          <td>Support</td>
          <td>Email</td>
          <td>Email</td>
          <td>Prioritaire</td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- FAQ -->
  <section class="faq-section">
    <h2 style="text-align: center; margin-bottom: var(--space-xl);">Questions fréquentes</h2>
    
    <div class="faq-item">
      <div class="faq-question">Puis-je changer de plan à tout moment ?</div>
      <div class="faq-answer">Oui, vous pouvez upgrader ou downgrader votre plan à tout moment. Le changement prend effet immédiatement.</div>
    </div>
    
    <div class="faq-item">
      <div class="faq-question">Y a-t-il un engagement ?</div>
      <div class="faq-answer">Non, aucun engagement. Vous pouvez annuler votre abonnement à tout moment sans frais.</div>
    </div>
    
    <div class="faq-item">
      <div class="faq-question">Mes données sont-elles sécurisées ?</div>
      <div class="faq-answer">Oui, vos données financières restent sur votre appareil (localStorage). Nous ne stockons pas vos informations bancaires.</div>
    </div>
    
    <div class="faq-item">
      <div class="faq-question">Comment fonctionne le paiement ?</div>
      <div class="faq-answer">Le paiement est mensuel, par carte bancaire. Vous recevrez une facture chaque mois par email.</div>
    </div>
  </section>

  <footer class="footer">
    <a href="index.html">Accueil</a> ·
    <a href="test.html">Test gratuit</a> ·
    <a href="login.html" data-auth="out">Connexion</a>
    <a href="dashboard.html" data-auth="in">Dashboard</a> ·
    <span class="muted">© <span id="year"></span> Où part mon argent</span>
  </footer>
</main>

<script src="assets/nav-auth.js"></script>
<script>
// ============================================
// CONFIGURATION
// ============================================
document.getElementById('year').textContent = new Date().getFullYear();

const PLAN_ORDER = ['free', 'essential', 'complete'];

// ============================================
// UTILITAIRES
// ============================================
function isLoggedIn() {
  try {
    const s = JSON.parse(localStorage.getItem("auth_session_v1"));
    return !!(s && s.email);
  } catch { 
    return false; 
  }
}

function getCurrentPlan() {
  try {
    const plan = localStorage.getItem('plan');
    if (!plan) return 'free';
    return JSON.parse(plan);
  } catch {
    return 'free';
  }
}

function setCurrentPlan(plan) {
  localStorage.setItem('plan', JSON.stringify(plan));
}

// ============================================
// MISE À JOUR DE L'INTERFACE
// ============================================
function updatePricingUI() {
  const loggedIn = isLoggedIn();
  const currentPlan = getCurrentPlan();
  const currentIndex = PLAN_ORDER.indexOf(currentPlan);
  
  // Pour chaque plan
  PLAN_ORDER.forEach((plan, index) => {
    const card = document.getElementById('card-' + plan);
    const badge = document.getElementById('badge-' + plan);
    const btn = document.getElementById('btn-' + plan);
    const popularBadge = document.getElementById('popular-badge-' + plan);
    
    // Reset
    card.classList.remove('current');
    badge.style.display = 'none';
    btn.classList.remove('current-plan');
    btn.disabled = false;
    
    if (loggedIn) {
      // Utilisateur connecté
      if (plan === currentPlan) {
        // Plan actuel
        card.classList.add('current');
        badge.style.display = 'block';
        if (popularBadge) popularBadge.style.display = 'none';
        btn.textContent = '✓ Votre plan actuel';
        btn.classList.add('current-plan');
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-secondary');
        btn.disabled = true;
      } else if (index > currentIndex) {
        // Plan supérieur
        btn.textContent = 'Passer à ' + getPlanName(plan);
        btn.classList.remove('btn-secondary');
        btn.classList.add('btn-primary');
      } else {
        // Plan inférieur
        btn.textContent = 'Rétrograder vers ' + getPlanName(plan);
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-secondary');
      }
    } else {
      // Utilisateur non connecté
      if (plan === 'free') {
        btn.textContent = 'Créer un compte gratuit';
      } else {
        btn.textContent = 'Créer un compte';
      }
    }
  });
}

function getPlanName(plan) {
  const names = {
    free: 'Gratuit',
    essential: 'Essentiel',
    complete: 'Complet'
  };
  return names[plan] || plan;
}

// ============================================
// ACTIONS
// ============================================
function handlePlanClick(plan) {
  const loggedIn = isLoggedIn();
  const currentPlan = getCurrentPlan();
  
  if (!loggedIn) {
    // Rediriger vers inscription
    window.location.href = 'login.html';
    return;
  }
  
  if (plan === currentPlan) {
    // Déjà sur ce plan
    return;
  }
  
  const currentIndex = PLAN_ORDER.indexOf(currentPlan);
  const newIndex = PLAN_ORDER.indexOf(plan);
  
  if (newIndex > currentIndex) {
    // Upgrade
    if (confirm(`Passer au plan ${getPlanName(plan)} ?\n\nNote : Dans cette version démo, le changement est immédiat et gratuit.`)) {
      setCurrentPlan(plan);
      updatePricingUI();
      alert(`✅ Vous êtes maintenant sur le plan ${getPlanName(plan)} !\n\nRetournez sur votre Dashboard pour profiter des nouvelles fonctionnalités.`);
    }
  } else {
    // Downgrade
    if (confirm(`Rétrograder vers le plan ${getPlanName(plan)} ?\n\nVous perdrez l'accès à certaines fonctionnalités.`)) {
      setCurrentPlan(plan);
      updatePricingUI();
      alert(`Vous êtes maintenant sur le plan ${getPlanName(plan)}.`);
    }
  }
}

// ============================================
// INITIALISATION
// ============================================
document.addEventListener('DOMContentLoaded', function() {
  updatePricingUI();
});

// Mettre à jour quand nav-auth a fini
setTimeout(updatePricingUI, 100);
</script>

</body>
</html>