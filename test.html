<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Test gratuit ‚Äî O√π part mon argent ?</title>
  <meta name="description" content="Test gratuit : estimez votre minimum vital et votre reste √† vivre en 2 minutes." />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <div class="logo">‚Ç¨</div>
      <div>
        <div class="brand-title">O√π part mon argent</div>
        <div class="brand-subtitle">Test gratuit</div>
      </div>
    </div>

    <nav class="nav">
      <a class="nav-link" href="index.html">Accueil</a>
      <a class="nav-link active" href="test.html">Test gratuit</a>
      <a class="nav-link" href="tarifs.html">Tarifs</a>
      <a class="nav-link" href="login.html">Connexion</a>
    </nav>
  </header>

  <main class="container">
    <section class="card">
      <h1>Test gratuit</h1>
      <p class="lead">
        Entrez des montants <strong>approximatifs</strong>. Vous obtenez une estimation de votre
        <strong>minimum vital</strong> et de votre <strong>reste √† vivre</strong>.
      </p>

      <form class="form" id="freeTestForm">
        <div class="form-row">
          <div class="field">
            <label for="income">Revenu mensuel net (‚Ç¨)</label>
            <input id="income" name="income" type="number" min="0" step="1" placeholder="Ex : 1800" required />
          </div>
          <div class="field">
            <label for="rent">Logement / loyer (‚Ç¨)</label>
            <input id="rent" name="rent" type="number" min="0" step="1" placeholder="Ex : 650" required />
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label for="fixed">Charges fixes (internet, assurances‚Ä¶) (‚Ç¨)</label>
            <input id="fixed" name="fixed" type="number" min="0" step="1" placeholder="Ex : 220" required />
          </div>
          <div class="field">
            <label for="variable">Courses + transport (estimation) (‚Ç¨)</label>
            <input id="variable" name="variable" type="number" min="0" step="1" placeholder="Ex : 450" required />
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label for="subs">Abonnements (Netflix, tel‚Ä¶) (‚Ç¨) <span class="muted">(optionnel)</span></label>
            <input id="subs" name="subs" type="number" min="0" step="1" placeholder="Ex : 40" />
          </div>
          <div class="field">
            <label for="risk">Jeux d‚Äôargent / casino (‚Ç¨) <span class="muted">(optionnel)</span></label>
            <input id="risk" name="risk" type="number" min="0" step="1" placeholder="Ex : 0" />
          </div>
        </div>

        <button class="btn btn-primary" type="submit">Calculer</button>

        <p class="hint">
          üîí Ce test ne sauvegarde rien. Pour un tableau de bord + suivi + rappels email, cr√©ez un compte ensuite.
        </p>
      </form>

      <div class="divider"></div>

      <section id="result" class="result-box" style="display:none;">
        <h2>Votre estimation</h2>

        <div class="mini-grid">
          <div class="mini-card">
            <div class="mini-title">Minimum vital (mois)</div>
            <div class="mini-value" id="outMinMonth">‚Äî</div>
          </div>
          <div class="mini-card">
            <div class="mini-title">Minimum vital (semaine)</div>
            <div class="mini-value" id="outMinWeek">‚Äî</div>
          </div>
          <div class="mini-card">
            <div class="mini-title">Reste √† vivre (mois)</div>
            <div class="mini-value" id="outLeftMonth">‚Äî</div>
          </div>
        </div>

        <div class="card" style="margin-top:14px; background: rgba(255,255,255,.03); box-shadow:none;">
          <div class="mini-title">Lecture rapide</div>
          <div class="mini-value" style="font-size:18px" id="outMessage">‚Äî</div>
          <p class="muted" style="margin:8px 0 0; font-size:13px" id="outTip"></p>
        </div>

        <div class="cta-row">
          <a class="btn btn-primary" href="login.html">Cr√©er un compte</a>
          <a class="btn btn-secondary" href="tarifs.html">Voir les offres</a>
        </div>
      </section>
    </section>
  </main>

  <footer class="footer">
    <span>¬© <span id="year"></span> O√π part mon argent</span>
  </footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    const eur = (n) => new Intl.NumberFormat("fr-FR", { style: "currency", currency: "EUR" }).format(n);

    // Choix volontaire : 4.33 semaines / mois (moyenne) => plus r√©aliste qu'un /4
    const WEEKS_PER_MONTH = 4.33;

    function toNumber(id) {
      const v = document.getElementById(id).value;
      if (v === "" || v === null || v === undefined) return 0;
      const n = Number(v);
      return Number.isFinite(n) && n >= 0 ? n : 0;
    }

    function clamp(n) {
      return Number.isFinite(n) ? n : 0;
    }

    document.getElementById("freeTestForm").addEventListener("submit", (e) => {
      e.preventDefault();

      const income = toNumber("income");
      const rent = toNumber("rent");
      const fixed = toNumber("fixed");
      const variable = toNumber("variable");
      const subs = toNumber("subs");
      const risk = toNumber("risk");

      // Minimum vital = d√©penses n√©cessaires + abonnements + risque (ici on les compte car ce sont des sorties r√©elles)
      const minMonth = clamp(rent + fixed + variable + subs + risk);
      const minWeek = clamp(minMonth / WEEKS_PER_MONTH);
      const leftMonth = clamp(income - minMonth);

      // Affichage
      document.getElementById("outMinMonth").textContent = eur(minMonth);
      document.getElementById("outMinWeek").textContent = eur(minWeek);
      document.getElementById("outLeftMonth").textContent = eur(leftMonth);

      // Lecture simple (vert/orange/rouge) selon le reste √† vivre
      let message = "";
      let tip = "";

      if (income === 0) {
        message = "Entrez un revenu pour obtenir une estimation fiable.";
        tip = "Si vous n‚Äôavez pas de revenu fixe, mettez une moyenne mensuelle.";
      } else if (leftMonth < 0) {
        message = "üî¥ Vous d√©pensez plus que votre revenu (d√©ficit).";
        tip = "La priorit√© : r√©duire abonnements/risques et ajuster les variables (courses/transport) d√®s cette semaine.";
      } else if (leftMonth < income * 0.10) {
        message = "üü† Vous avez peu de marge (reste √† vivre faible).";
        tip = "Objectif : remonter votre marge √† 10‚Äì15% du revenu (petites coupes r√©guli√®res).";
      } else {
        message = "üü¢ Vous avez une marge correcte. Vous pouvez structurer une √©pargne.";
        tip = "Fixez un objectif (ex : voiture 10 000 ‚Ç¨) et mettez en place un montant par semaine.";
      }

      // Info sur abonnements/risque si renseign√©
      const leaks = subs + risk;
      if (leaks >= 50) {
        tip += ` (Info : vos postes ‚Äúabonnements/risque‚Äù totalisent ${eur(leaks)} / mois.)`;
      }

      document.getElementById("outMessage").textContent = message;
      document.getElementById("outTip").textContent = tip;

      document.getElementById("result").style.display = "block";
      document.getElementById("result").scrollIntoView({ behavior: "smooth", block: "start" });
    });
  </script>
</body>
</html>
<link rel="stylesheet" href="css/style.css" />
