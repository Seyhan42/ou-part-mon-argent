<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Test gratuit â€” OÃ¹ part mon argent ?</title>
  <meta name="description" content="Test gratuit : estimez votre minimum vital et votre reste Ã  vivre en 2 minutes.">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<header class="header">
  <div class="brand">
    <div class="logo">â‚¬</div>
    <div>
      <div class="brand-title">OÃ¹ part mon argent ?</div>
      <div class="brand-subtitle">Test gratuit</div>
    </div>
  </div>

  <nav class="nav">
  <a class="nav-link" href="/index.html">Accueil</a>
  <a class="nav-link" href="/test.html">Test gratuit</a>
  <a class="nav-link" href="/tarifs.html">Tarifs</a>

  <!-- Visible si PAS connectÃ© -->
  <a class="nav-link" href="/register.html" data-auth="out">CrÃ©er un compte</a>
  <a class="nav-link" href="/login.html" data-auth="out">Connexion</a>

  <!-- Visible si connectÃ© -->
  <a class="nav-link" href="/dashboard.html" data-auth="in">Dashboard</a>
  <button class="btn-ghost" type="button" data-auth="in" data-logout>
    DÃ©connexion
  </button>
</nav>

</header>

<main class="container">
  <div class="test-container">
    <section class="card">
      <h1>Test gratuit</h1>
      <p class="lead">
        Entrez des montants approximatifs pour obtenir une estimation de votre
        <strong>minimum vital</strong> et de votre <strong>reste Ã  vivre</strong>.
      </p>

      <form class="form" id="freeTestForm">
        <div class="form-row">
          <div class="field">
            <label for="income">Revenu mensuel net (â‚¬)</label>
            <input id="income" name="income" type="number" min="0" step="1" placeholder="Ex : 1800" required>
          </div>
          <div class="field">
            <label for="rent">Logement / loyer (â‚¬)</label>
            <input id="rent" name="rent" type="number" min="0" step="1" placeholder="Ex : 650" required>
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label for="fixed">Charges fixes (internet, assurancesâ€¦) (â‚¬)</label>
            <input id="fixed" name="fixed" type="number" min="0" step="1" placeholder="Ex : 220" required>
          </div>
          <div class="field">
            <label for="variable">Courses + transport (estimation) (â‚¬)</label>
            <input id="variable" name="variable" type="number" min="0" step="1" placeholder="Ex : 450" required>
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label for="subs">Abonnements (Netflix, telâ€¦) (â‚¬) <span class="muted">(optionnel)</span></label>
            <input id="subs" name="subs" type="number" min="0" step="1" placeholder="Ex : 40">
          </div>
          <div class="field">
            <label for="risk">Jeux d'argent / casino (â‚¬) <span class="muted">(optionnel)</span></label>
            <input id="risk" name="risk" type="number" min="0" step="1" placeholder="Ex : 0">
          </div>
        </div>

        <button class="btn btn-primary" type="submit">Calculer</button>

        <p class="hint">
          Ce test ne sauvegarde rien. Pour un tableau de bord + suivi + rappels email, crÃ©ez un compte ensuite.
        </p>
      </form>

      <div class="divider"></div>

      <section id="result" class="result-box" style="display:none;">
        <h2>Votre estimation</h2>

        <div class="mini-grid">
          <div class="mini-card">
            <div class="mini-title">Minimum vital (mois)</div>
            <div class="mini-value" id="outMinMonth">â€”</div>
          </div>
          <div class="mini-card">
            <div class="mini-title">Minimum vital (semaine)</div>
            <div class="mini-value" id="outMinWeek">â€”</div>
          </div>
          <div class="mini-card">
            <div class="mini-title">Reste Ã  vivre (mois)</div>
            <div class="mini-value" id="outLeftMonth">â€”</div>
          </div>
        </div>

        <div class="card mt-md" style="background: var(--bg-subtle); border: 1px solid var(--border-light);">
          <div class="mini-title">Lecture rapide</div>
          <p style="font-size: 1rem; font-weight: 600; color: var(--text-primary); margin: 8px 0;" id="outMessage">â€”</p>
          <p class="muted small" id="outTip"></p>
        </div>

        <div class="cta-row mt-lg">
          <a class="btn btn-primary" href="login.html">CrÃ©er un compte</a>
          <a class="btn btn-secondary" href="tarifs.html">Voir les offres</a>
        </div>
      </section>
    </section>
  </div>
</main>

<footer class="footer">
  <span>Â© <span id="year"></span> OÃ¹ part mon argent</span>
</footer>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();

  const eur = (n) => new Intl.NumberFormat("fr-FR", { style: "currency", currency: "EUR" }).format(n);
  const WEEKS_PER_MONTH = 4.33;

  function toNumber(id) {
    const v = document.getElementById(id).value;
    if (v === "" || v === null || v === undefined) return 0;
    const n = Number(v);
    return Number.isFinite(n) && n >= 0 ? n : 0;
  }

  function clamp(n) {
    return Number.isFinite(n) ? n : 0;
  }

  document.getElementById("freeTestForm").addEventListener("submit", (e) => {
    e.preventDefault();

    const income = toNumber("income");
    const rent = toNumber("rent");
    const fixed = toNumber("fixed");
    const variable = toNumber("variable");
    const subs = toNumber("subs");
    const risk = toNumber("risk");

    const minMonth = clamp(rent + fixed + variable + subs + risk);
    const minWeek = clamp(minMonth / WEEKS_PER_MONTH);
    const leftMonth = clamp(income - minMonth);

    document.getElementById("outMinMonth").textContent = eur(minMonth);
    document.getElementById("outMinWeek").textContent = eur(minWeek);
    document.getElementById("outLeftMonth").textContent = eur(leftMonth);

    let message = "";
    let tip = "";

    if (income === 0) {
      message = "Entrez un revenu pour obtenir une estimation fiable.";
      tip = "Si vous n'avez pas de revenu fixe, mettez une moyenne mensuelle.";
    } else if (leftMonth < 0) {
      message = "ðŸ”´ Vous dÃ©pensez plus que votre revenu (dÃ©ficit).";
      tip = "La prioritÃ© : rÃ©duire abonnements/risques et ajuster les variables (courses/transport) dÃ¨s cette semaine.";
    } else if (leftMonth < income * 0.10) {
      message = "ðŸŸ  Vous avez peu de marge (reste Ã  vivre faible).";
      tip = "Objectif : remonter votre marge Ã  10â€“15% du revenu (petites coupes rÃ©guliÃ¨res).";
    } else {
      message = "ðŸŸ¢ Vous avez une marge correcte. Vous pouvez structurer une Ã©pargne.";
      tip = "Fixez un objectif (ex : voiture 10 000 â‚¬) et mettez en place un montant par semaine.";
    }

    const leaks = subs + risk;
    if (leaks >= 50) {
      tip += ` (Info : vos postes "abonnements/risque" totalisent ${eur(leaks)} / mois.)`;
    }

    document.getElementById("outMessage").textContent = message;
    document.getElementById("outTip").textContent = tip;

    document.getElementById("result").style.display = "block";
    document.getElementById("result").scrollIntoView({ behavior: "smooth", block: "start" });
  });
</script>

</body>
</html>
