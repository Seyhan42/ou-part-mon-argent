<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Connexion ‚Äì O√π part mon argent ?</title>
  <link rel="stylesheet" href="css/style.css?v=2">
</head>
<body>

<header class="header">
  <div class="brand">
    <div class="logo">‚Ç¨</div>
    <div>
      <div class="brand-title">O√π part mon argent ?</div>
      <div class="brand-subtitle">Connexion</div>
    </div>
  </div>

  <nav class="nav">
    <a class="nav-link" href="index.html">Accueil</a>
    <a class="nav-link" href="test.html">Test gratuit</a>
    <a class="nav-link" href="tarifs.html">Tarifs</a>
    <a class="nav-link active" href="login.html" data-auth="out">Connexion</a>
    <a class="nav-link" href="dashboard.html" data-auth="in">Dashboard</a>
    <button class="btn-ghost" type="button" data-auth="in" data-logout>D√©connexion</button>
  </nav>
</header>

<main class="container">
  <section class="hero compact">
    <h1>Connectez-vous</h1>
    <p class="lead">Acc√©dez √† votre tableau de bord et suivez votre budget.</p>
  </section>

  <div class="login-grid">
    <!-- Connexion -->
    <div class="card">
      <h2>üîê Connexion</h2>
      <p>Vous avez d√©j√† un compte ?</p>
      
      <form class="form" id="login-form">
        <div class="field">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" placeholder="votre@email.com" required>
        </div>
        <div class="field">
          <label for="login-password">Mot de passe</label>
          <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
        </div>
        <div id="login-error" style="color: #dc2626; font-size: 14px; display: none;"></div>
        <button type="submit" class="btn btn-primary full">Se connecter</button>
      </form>
    </div>

    <!-- Inscription -->
    <div class="card">
      <h2>‚ú® Cr√©er un compte</h2>
      <p>Nouveau ? Inscrivez-vous gratuitement.</p>
      
      <form class="form" id="register-form">
        <div class="field">
          <label for="register-email">Email</label>
          <input type="email" id="register-email" placeholder="votre@email.com" required>
        </div>
        <div class="field">
          <label for="register-password">Mot de passe</label>
          <input type="password" id="register-password" placeholder="Min. 6 caract√®res" minlength="6" required>
        </div>
        <div class="field">
          <label for="register-password-confirm">Confirmer le mot de passe</label>
          <input type="password" id="register-password-confirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
        </div>
        <div id="register-error" style="color: #dc2626; font-size: 14px; display: none;"></div>
        <div id="register-success" style="color: var(--accent); font-size: 14px; display: none;"></div>
        <button type="submit" class="btn btn-primary full">Cr√©er mon compte</button>
      </form>
    </div>
  </div>

  <div class="hint" style="max-width: 600px; margin: var(--space-xl) auto; text-align: center;">
    <strong>üîí Vos donn√©es sont s√©curis√©es</strong><br>
    Nous ne partageons jamais vos informations. Votre budget reste priv√©.
  </div>

  <footer class="footer">
    <a href="tarifs.html">Tarifs</a> ¬∑
    <a href="index.html">Accueil</a> ¬∑
    <span class="muted">¬© <span id="year"></span> O√π part mon argent</span>
  </footer>
</main>

<script src="assets/nav-auth.js"></script>
<script>
// ============================================
// GESTION AUTHENTIFICATION
// ============================================

// Rediriger si d√©j√† connect√©
(function() {
  try {
    const s = JSON.parse(localStorage.getItem("auth_session_v1"));
    if (s && s.email) {
      window.location.href = 'dashboard.html';
    }
  } catch {}
})();

// R√©cup√©rer les utilisateurs stock√©s
function getUsers() {
  try {
    const users = localStorage.getItem('users');
    return users ? JSON.parse(users) : [];
  } catch { return []; }
}

function saveUsers(users) {
  localStorage.setItem('users', JSON.stringify(users));
}

// Hash simple du mot de passe (pour d√©mo - en prod utiliser bcrypt c√¥t√© serveur)
function hashPassword(password) {
  let hash = 0;
  for (let i = 0; i < password.length; i++) {
    const char = password.charCodeAt(i);
    hash = ((hash << 5) - hash) + char;
    hash = hash & hash;
  }
  return hash.toString(16);
}

// ============================================
// CONNEXION
// ============================================
document.getElementById('login-form').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const email = document.getElementById('login-email').value.trim().toLowerCase();
  const password = document.getElementById('login-password').value;
  const errorEl = document.getElementById('login-error');
  
  errorEl.style.display = 'none';
  
  // V√©rifier les identifiants
  const users = getUsers();
  const user = users.find(u => u.email === email);
  
  if (!user) {
    errorEl.textContent = 'Aucun compte trouv√© avec cet email.';
    errorEl.style.display = 'block';
    return;
  }
  
  if (user.passwordHash !== hashPassword(password)) {
    errorEl.textContent = 'Mot de passe incorrect.';
    errorEl.style.display = 'block';
    return;
  }
  
  // Connexion r√©ussie
  const session = {
    email: user.email,
    createdAt: user.createdAt,
    loginAt: new Date().toISOString()
  };
  
  localStorage.setItem('auth_session_v1', JSON.stringify(session));
  
  // Rediriger vers dashboard
  window.location.href = 'dashboard.html';
});

// ============================================
// INSCRIPTION
// ============================================
document.getElementById('register-form').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const email = document.getElementById('register-email').value.trim().toLowerCase();
  const password = document.getElementById('register-password').value;
  const passwordConfirm = document.getElementById('register-password-confirm').value;
  const errorEl = document.getElementById('register-error');
  const successEl = document.getElementById('register-success');
  
  errorEl.style.display = 'none';
  successEl.style.display = 'none';
  
  // Validation
  if (password.length < 6) {
    errorEl.textContent = 'Le mot de passe doit faire au moins 6 caract√®res.';
    errorEl.style.display = 'block';
    return;
  }
  
  if (password !== passwordConfirm) {
    errorEl.textContent = 'Les mots de passe ne correspondent pas.';
    errorEl.style.display = 'block';
    return;
  }
  
  // V√©rifier si l'email existe d√©j√†
  const users = getUsers();
  if (users.find(u => u.email === email)) {
    errorEl.textContent = 'Un compte existe d√©j√† avec cet email.';
    errorEl.style.display = 'block';
    return;
  }
  
  // Cr√©er l'utilisateur
  const newUser = {
    email: email,
    passwordHash: hashPassword(password),
    createdAt: new Date().toISOString(),
    plan: 'free'
  };
  
  users.push(newUser);
  saveUsers(users);
  
  // Connecter automatiquement
  const session = {
    email: newUser.email,
    createdAt: newUser.createdAt,
    loginAt: new Date().toISOString()
  };
  
  localStorage.setItem('auth_session_v1', JSON.stringify(session));
  localStorage.setItem('plan', JSON.stringify('free'));
  
  successEl.textContent = 'Compte cr√©√© ! Redirection...';
  successEl.style.display = 'block';
  
  // Rediriger vers dashboard
  setTimeout(() => {
    window.location.href = 'dashboard.html';
  }, 1000);
});

// Footer year
document.getElementById('year').textContent = new Date().getFullYear();
</script>

</body>
</html>
