<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard ‚Äì O√π part mon argent ?</title>
  <link rel="stylesheet" href="css/style.css?v=2">
  <style>
    *{-webkit-tap-highlight-color:transparent;box-sizing:border-box}
    .dashboard-layout{display:flex;min-height:calc(100vh - 70px)}
    .sidebar{width:260px;background:var(--bg-card);border-right:1px solid var(--border-light);padding:20px;flex-shrink:0}
    .sidebar-menu{list-style:none;padding:0;margin:0}
    .sidebar-item{margin-bottom:4px}
    .sidebar-link{display:flex;align-items:center;gap:8px;padding:12px;border-radius:8px;color:#4b5563;font-size:14px;font-weight:500;text-decoration:none;cursor:pointer;background:#f9fafb;border:none;width:100%;text-align:left}
    .sidebar-link:active,.sidebar-link.active{background:#0d9f6f;color:#fff}
    .sidebar-icon{font-size:18px}
    .sidebar-badge{margin-left:auto;font-size:10px;padding:2px 6px;border-radius:99px;background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff}
    .sidebar-badge.max{background:linear-gradient(135deg,#3b82f6,#1d4ed8)}
    .plan-card{background:rgba(13,159,111,.1);border:1px solid rgba(13,159,111,.2);border-radius:12px;padding:16px;text-align:center;margin-bottom:20px}
    .plan-card-label{font-size:11px;color:#6b7280;text-transform:uppercase}
    .plan-card-name{font-size:18px;font-weight:700;color:#0d9f6f}
    .dashboard-main{flex:1;padding:24px;max-width:1100px}
    .page-title{font-size:24px;font-weight:700;margin-bottom:4px}
    .page-subtitle{color:#6b7280;font-size:14px;margin-bottom:24px}
    .section{display:none}
    .section.active{display:block}
    .grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:16px}
    .grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:20px;margin-top:20px}
    .stat-card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:20px}
    .stat-label{font-size:11px;font-weight:600;text-transform:uppercase;color:#6b7280;margin-bottom:8px}
    .stat-value{font-size:24px;font-weight:700}
    .stat-value.positive{color:#0d9f6f}
    .stat-value.negative{color:#dc2626}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:20px}
    .badge{font-size:11px;font-weight:600;padding:4px 10px;border-radius:99px;background:#f3f4f6;color:#6b7280}
    .badge.success{background:rgba(13,159,111,.1);color:#0d9f6f}
    .badge.warning{background:rgba(245,158,11,.1);color:#d97706}
    .badge.danger{background:rgba(220,38,38,.1);color:#dc2626}
    .locked-overlay{text-align:center;padding:40px;background:#f9fafb;border-radius:12px;border:2px dashed #d1d5db}
    .locked-icon{font-size:48px;margin-bottom:16px}
    .locked-title{font-size:18px;font-weight:600;margin-bottom:16px}
    .btn{display:inline-block;padding:12px 24px;border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;border:none;text-decoration:none;text-align:center}
    .btn-primary{background:#0d9f6f;color:#fff}
    .btn-secondary{background:#f3f4f6;color:#374151}
    .cta-row{display:flex;gap:12px}
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:1000;align-items:center;justify-content:center}
    .modal.open{display:flex}
    .modal-content{background:#fff;border-radius:16px;max-width:400px;width:90%;padding:24px}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
    .modal-close{background:none;border:none;font-size:24px;cursor:pointer;color:#6b7280;padding:8px}
    .field{margin-bottom:12px}
    .field label{display:block;font-size:14px;font-weight:500;margin-bottom:6px;color:#374151}
    .field input,.field select{width:100%;padding:12px;border:1px solid #d1d5db;border-radius:8px;font-size:16px}
    .action-btn{display:flex;align-items:center;gap:8px;padding:12px;border:1px solid #e5e7eb;border-radius:8px;background:#fff;cursor:pointer;width:100%;text-align:left;font-size:14px;margin-bottom:8px}
    .action-btn:active{background:#f3f4f6}
    @media(max-width:768px){
      .dashboard-layout{flex-direction:column}
      .sidebar{width:100%;padding:12px;border-right:none;border-bottom:1px solid #e5e7eb}
      .plan-card{display:none}
      .sidebar-menu{display:flex;gap:8px;overflow-x:auto;padding-bottom:4px}
      .sidebar-item{flex-shrink:0}
      .sidebar-link{padding:10px 16px;white-space:nowrap;border-radius:20px}
      .sidebar-badge{display:none}
      .dashboard-main{padding:16px}
      .grid-4,.grid-3{grid-template-columns:1fr 1fr;gap:12px}
      .grid-2{grid-template-columns:1fr}
      .stat-card,.card{padding:16px}
      .stat-value{font-size:20px}
      .cta-row{flex-direction:column}
      .cta-row .btn{width:100%}
    }
  </style>
</head>
<body>
<header class="header"><div class="brand"><div class="logo">‚Ç¨</div><div><div class="brand-title">O√π part mon argent ?</div><div class="brand-subtitle">Dashboard</div></div></div><nav class="nav"><a class="nav-link" href="index.html">Accueil</a><a class="nav-link" href="test.html">Test</a><a class="nav-link" href="tarifs.html">Tarifs</a></nav></header>

<div class="dashboard-layout">
  <aside class="sidebar">
    <div class="plan-card"><div class="plan-card-label">Votre plan</div><div class="plan-card-name" id="sidebar-plan">Gratuit</div></div>
    <ul class="sidebar-menu" id="main-menu">
      <li class="sidebar-item"><button class="sidebar-link active" data-section="resume"><span class="sidebar-icon">üìä</span>R√©sum√©</button></li>
      <li class="sidebar-item"><button class="sidebar-link" data-section="historique"><span class="sidebar-icon">üìã</span>Historique</button></li>
      <li class="sidebar-item"><button class="sidebar-link" data-section="epargne"><span class="sidebar-icon">üíé</span>√âpargne<span class="sidebar-badge" id="badge-epargne">PRO</span></button></li>
      <li class="sidebar-item"><button class="sidebar-link" data-section="fuites"><span class="sidebar-icon">üí∏</span>Fuites<span class="sidebar-badge" id="badge-fuites">PRO</span></button></li>
      <li class="sidebar-item"><button class="sidebar-link" data-section="comparateur"><span class="sidebar-icon">‚öñÔ∏è</span>Comparateur<span class="sidebar-badge" id="badge-comparateur">PRO</span></button></li>
      <li class="sidebar-item"><button class="sidebar-link" data-section="imprevu"><span class="sidebar-icon">üö®</span>Impr√©vu<span class="sidebar-badge max" id="badge-imprevu">MAX</span></button></li>
    </ul>
  </aside>

  <main class="dashboard-main">
    <!-- R√âSUM√â -->
    <section class="section active" id="section-resume">
      <h1 class="page-title">üìä R√©sum√© financier</h1>
      <p class="page-subtitle">Vue d'ensemble de votre situation</p>
      <div class="grid-4">
        <div class="stat-card"><div class="stat-label">Revenus</div><div class="stat-value" id="stat-revenus">‚Äî</div></div>
        <div class="stat-card"><div class="stat-label">D√©p. essentielles</div><div class="stat-value" id="stat-dep-ess">‚Äî</div></div>
        <div class="stat-card"><div class="stat-label">D√©p. non ess.</div><div class="stat-value" id="stat-dep-non-ess">‚Äî</div></div>
        <div class="stat-card"><div class="stat-label">Reste √† vivre</div><div class="stat-value positive" id="stat-reste">‚Äî</div></div>
      </div>
      <div class="grid-3" id="premium-stats-row" style="display:none">
        <div class="stat-card"><div class="stat-label">√âpargne</div><div class="stat-value positive" id="stat-epargne">‚Äî</div></div>
        <div class="stat-card"><div class="stat-label">Fuites</div><div class="stat-value negative" id="stat-fuites">‚Äî</div></div>
        <div class="stat-card"><div class="stat-label">Score</div><div class="stat-value" id="stat-score">‚Äî</div></div>
      </div>
      <div class="grid-2">
        <div class="card">
          <h3 style="margin-bottom:16px">üéØ Dernier test</h3>
          <div style="display:flex;align-items:center;gap:16px;margin-bottom:16px">
            <div style="width:70px;height:70px;border-radius:50%;background:#f3f4f6;display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:700" id="score-display">‚Äî</div>
            <div><div style="font-weight:600" id="test-title">Aucun test</div><div style="font-size:14px;color:#6b7280" id="test-date">Faites un test pour commencer</div></div>
          </div>
          <a href="test.html" class="btn btn-primary" style="width:100%">üîÑ Faire un test</a>
        </div>
        <div class="card">
          <h3 style="margin-bottom:16px">‚ö° Actions rapides</h3>
          <button class="action-btn" data-section="historique"><span>üìã</span>Voir l'historique</button>
          <button class="action-btn" data-section="epargne"><span>üíé</span>G√©rer l'√©pargne</button>
          <button class="action-btn" data-section="fuites"><span>üí∏</span>Voir les fuites</button>
          <button class="action-btn" data-section="comparateur"><span>‚öñÔ∏è</span>Comparer des choix</button>
        </div>
      </div>
    </section>

    <!-- HISTORIQUE -->
    <section class="section" id="section-historique">
      <h1 class="page-title">üìã Historique des tests</h1>
      <p class="page-subtitle">Suivez votre √©volution</p>
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
          <span class="badge" id="historique-count">0 tests</span>
          <a href="test.html" class="btn btn-primary">+ Nouveau test</a>
        </div>
        <div id="historique-list" style="color:#6b7280">Aucun test enregistr√©</div>
      </div>
    </section>

    <!-- √âPARGNE -->
    <section class="section" id="section-epargne">
      <h1 class="page-title">üíé Objectif √©pargne</h1>
      <p class="page-subtitle">Suivez votre progression</p>
      <div id="epargne-content">
        <div class="card">
          <div style="text-align:center;margin-bottom:20px">
            <div style="font-size:12px;color:#6b7280">Objectif</div>
            <div style="font-size:32px;font-weight:800" id="objectif-montant">0 ‚Ç¨</div>
          </div>
          <div style="height:12px;background:#f3f4f6;border-radius:99px;overflow:hidden;margin-bottom:20px">
            <div id="progress-fill" style="height:100%;background:#0d9f6f;width:0%;transition:width 0.5s"></div>
          </div>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;text-align:center;margin-bottom:20px">
            <div style="background:#f3f4f6;padding:12px;border-radius:8px"><div style="font-size:18px;font-weight:700;color:#0d9f6f" id="epargne-actuelle">0 ‚Ç¨</div><div style="font-size:11px;color:#6b7280">√âpargn√©</div></div>
            <div style="background:#f3f4f6;padding:12px;border-radius:8px"><div style="font-size:18px;font-weight:700;color:#d97706" id="epargne-restante">0 ‚Ç¨</div><div style="font-size:11px;color:#6b7280">Restant</div></div>
            <div style="background:#f3f4f6;padding:12px;border-radius:8px"><div style="font-size:18px;font-weight:700" id="epargne-mensuelle">0 ‚Ç¨</div><div style="font-size:11px;color:#6b7280">/mois conseill√©</div></div>
          </div>
          <div class="cta-row">
            <button class="btn btn-primary" id="btn-versement">‚ûï Ajouter</button>
            <button class="btn btn-secondary" id="btn-objectif">‚öôÔ∏è Modifier objectif</button>
          </div>
        </div>
      </div>
      <div id="epargne-locked" class="locked-overlay" style="display:none"><div class="locked-icon">üîí</div><div class="locked-title">Plan Essentiel requis</div><a href="tarifs.html" class="btn btn-primary">Voir les offres</a></div>
    </section>

    <!-- FUITES -->
    <section class="section" id="section-fuites">
      <h1 class="page-title">üí∏ Fuites budg√©taires</h1>
      <p class="page-subtitle">Identifiez vos d√©penses r√©currentes</p>
      <div id="fuites-content">
        <div class="grid-2">
          <div class="card">
            <h3 style="margin-bottom:12px">üì∫ Abonnements</h3>
            <div id="subscriptions-list" style="margin-bottom:12px;color:#6b7280">Aucun abonnement</div>
            <button class="btn btn-secondary" id="btn-abonnement">+ Ajouter</button>
          </div>
          <div class="card">
            <h3 style="margin-bottom:12px">üé∞ Jeux d'argent</h3>
            <div style="text-align:center;padding:20px;background:#f3f4f6;border-radius:8px;margin-bottom:12px">
              <div style="font-size:28px;font-weight:700" id="gambling-amount">0 ‚Ç¨</div>
              <div style="font-size:12px;color:#6b7280">/mois</div>
            </div>
            <button class="btn btn-secondary" style="width:100%" id="btn-jeux">Modifier</button>
          </div>
        </div>
        <div class="card" style="margin-top:16px;background:rgba(220,38,38,.05);border-color:rgba(220,38,38,.2)">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <span style="font-weight:600;color:#dc2626">üí∞ Total des fuites</span>
            <span style="font-size:24px;font-weight:700;color:#dc2626" id="total-fuites">0 ‚Ç¨/mois</span>
          </div>
        </div>
      </div>
      <div id="fuites-locked" class="locked-overlay" style="display:none"><div class="locked-icon">üîí</div><div class="locked-title">Plan Essentiel requis</div><a href="tarifs.html" class="btn btn-primary">Voir les offres</a></div>
    </section>

    <!-- COMPARATEUR -->
    <section class="section" id="section-comparateur">
      <h1 class="page-title">‚öñÔ∏è Comparateur de d√©cisions</h1>
      <p class="page-subtitle">Comparez deux choix financiers</p>
      <div id="comparateur-content">
        <div class="grid-2">
          <div class="card" style="border:2px solid #0d9f6f">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:16px"><div style="width:32px;height:32px;background:#0d9f6f;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700">A</div><input type="text" id="choix-a-nom" placeholder="Nom du choix A" style="flex:1;border:none;font-weight:600;font-size:16px"></div>
            <div class="field"><label>Co√ªt mensuel (‚Ç¨)</label><input type="number" id="choix-a-cout" placeholder="350"></div>
            <div class="field"><label>Dur√©e (mois)</label><input type="number" id="choix-a-duree" placeholder="48"></div>
          </div>
          <div class="card" style="border:2px solid #3b82f6">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:16px"><div style="width:32px;height:32px;background:#3b82f6;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700">B</div><input type="text" id="choix-b-nom" placeholder="Nom du choix B" style="flex:1;border:none;font-weight:600;font-size:16px"></div>
            <div class="field"><label>Co√ªt mensuel (‚Ç¨)</label><input type="number" id="choix-b-cout" placeholder="0"></div>
            <div class="field"><label>Dur√©e (mois)</label><input type="number" id="choix-b-duree" placeholder="48"></div>
          </div>
        </div>
        <div style="text-align:center;margin-top:20px"><button class="btn btn-primary" id="btn-comparer">‚öñÔ∏è Comparer</button></div>
        <div id="compare-result" style="display:none;margin-top:20px;padding:20px;background:#f3f4f6;border-radius:12px">
          <h3 style="text-align:center;margin-bottom:16px">üìä R√©sultat</h3>
          <div id="compare-text" style="text-align:center"></div>
        </div>
      </div>
      <div id="comparateur-locked" class="locked-overlay" style="display:none"><div class="locked-icon">üîí</div><div class="locked-title">Plan Essentiel requis</div><a href="tarifs.html" class="btn btn-primary">Voir les offres</a></div>
    </section>

    <!-- IMPR√âVU -->
    <section class="section" id="section-imprevu">
      <h1 class="page-title">üö® Simulateur d'impr√©vu</h1>
      <p class="page-subtitle">Testez la r√©sistance de votre budget</p>
      <div id="imprevu-content">
        <div class="card">
          <div class="field"><label>Type d'impr√©vu</label><select id="imprevu-type"><option>üîß R√©paration voiture</option><option>üè• Frais m√©dicaux</option><option>üè† Travaux maison</option><option>üì± Remplacement appareil</option></select></div>
          <div class="field"><label>Montant (‚Ç¨)</label><input type="number" id="imprevu-montant" placeholder="1500"></div>
          <div class="field"><label>√âtaler sur (mois)</label><input type="number" id="imprevu-mois" value="3" min="1" max="24"></div>
          <button class="btn btn-primary" style="width:100%;margin-top:8px" id="btn-simuler">üö® Simuler l'impact</button>
        </div>
        <div id="simulator-result" style="display:none;margin-top:16px;padding:20px;border-radius:12px"></div>
      </div>
      <div id="imprevu-locked" class="locked-overlay" style="display:none"><div class="locked-icon">üîí</div><div class="locked-title">Plan Complet requis</div><a href="tarifs.html" class="btn btn-primary">Voir les offres</a></div>
    </section>
  </main>
</div>

<!-- MODALS -->
<div class="modal" id="modal-versement"><div class="modal-content"><div class="modal-header"><h2>‚ûï Ajouter un versement</h2><button class="modal-close" data-close="modal-versement">√ó</button></div><div class="field"><label>Montant (‚Ç¨)</label><input type="number" id="versement-montant" placeholder="100"></div><div class="cta-row" style="margin-top:16px"><button class="btn btn-primary" id="btn-save-versement">Ajouter</button><button class="btn btn-secondary" data-close="modal-versement">Annuler</button></div></div></div>
<div class="modal" id="modal-objectif"><div class="modal-content"><div class="modal-header"><h2>‚öôÔ∏è Modifier l'objectif</h2><button class="modal-close" data-close="modal-objectif">√ó</button></div><div class="field"><label>Objectif (‚Ç¨)</label><input type="number" id="objectif-input" placeholder="15000"></div><div class="field"><label>D√©j√† √©pargn√© (‚Ç¨)</label><input type="number" id="epargne-input" placeholder="3000"></div><div class="cta-row" style="margin-top:16px"><button class="btn btn-primary" id="btn-save-objectif">Enregistrer</button><button class="btn btn-secondary" data-close="modal-objectif">Annuler</button></div></div></div>
<div class="modal" id="modal-abonnement"><div class="modal-content"><div class="modal-header"><h2>üì∫ Ajouter un abonnement</h2><button class="modal-close" data-close="modal-abonnement">√ó</button></div><div class="field"><label>Nom</label><input type="text" id="abo-nom" placeholder="Netflix, Spotify..."></div><div class="field"><label>Montant mensuel (‚Ç¨)</label><input type="number" id="abo-montant" placeholder="15.99" step="0.01"></div><div class="cta-row" style="margin-top:16px"><button class="btn btn-primary" id="btn-save-abonnement">Ajouter</button><button class="btn btn-secondary" data-close="modal-abonnement">Annuler</button></div></div></div>
<div class="modal" id="modal-jeux"><div class="modal-content"><div class="modal-header"><h2>üé∞ Jeux d'argent</h2><button class="modal-close" data-close="modal-jeux">√ó</button></div><div class="field"><label>Montant mensuel (‚Ç¨)</label><input type="number" id="jeux-montant" placeholder="50"></div><div class="cta-row" style="margin-top:16px"><button class="btn btn-primary" id="btn-save-jeux">Enregistrer</button><button class="btn btn-secondary" data-close="modal-jeux">Annuler</button></div></div></div>

<script>
// ========================================
// JAVASCRIPT INT√âGR√â - Dashboard
// ========================================

var PLANS = {
  free: { name: 'Gratuit', features: ['resume', 'historique'] },
  essential: { name: 'Essentiel', features: ['resume', 'historique', 'epargne', 'fuites', 'comparateur'] },
  complete: { name: 'Complet', features: ['resume', 'historique', 'epargne', 'fuites', 'comparateur', 'imprevu'] }
};

// Utilitaires
function formatMoney(n) { return new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR', minimumFractionDigits: 0 }).format(n || 0); }
function getData(k, def) { try { var v = localStorage.getItem(k); return v ? JSON.parse(v) : def; } catch(e) { return def; } }
function setData(k, v) { localStorage.setItem(k, JSON.stringify(v)); }

// Navigation
function showSection(id) {
  console.log('showSection:', id);
  document.querySelectorAll('.section').forEach(function(s) { s.classList.remove('active'); });
  document.querySelectorAll('.sidebar-link').forEach(function(l) { l.classList.remove('active'); });
  
  var section = document.getElementById('section-' + id);
  if (section) section.classList.add('active');
  
  var link = document.querySelector('.sidebar-link[data-section="' + id + '"]');
  if (link) link.classList.add('active');
}

// Modals
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }

// Initialisation
function initDashboard() {
  console.log('initDashboard');
  var plan = getData('plan', 'free');
  var planConfig = PLANS[plan] || PLANS.free;
  var lastTest = getData('lastTest', null);
  var tests = getData('tests', []);
  var savingsGoal = getData('savingsGoal', { objectif: 0, epargne: 0 });
  var subscriptions = getData('subscriptions', []);
  var gambling = getData('gambling', 0);

  // Plan
  document.getElementById('sidebar-plan').textContent = planConfig.name;

  // Badges
  ['epargne', 'fuites', 'comparateur', 'imprevu'].forEach(function(f) {
    var badge = document.getElementById('badge-' + f);
    if (badge && planConfig.features.indexOf(f) !== -1) badge.style.display = 'none';
  });

  // Acc√®s sections
  ['epargne', 'fuites', 'comparateur', 'imprevu'].forEach(function(f) {
    var content = document.getElementById(f + '-content');
    var locked = document.getElementById(f + '-locked');
    var hasAccess = planConfig.features.indexOf(f) !== -1;
    if (content) content.style.display = hasAccess ? 'block' : 'none';
    if (locked) locked.style.display = hasAccess ? 'none' : 'block';
  });

  // Stats premium
  var premiumRow = document.getElementById('premium-stats-row');
  if (premiumRow) premiumRow.style.display = plan !== 'free' ? 'grid' : 'none';

  // Dernier test
  if (lastTest) {
    document.getElementById('stat-revenus').textContent = formatMoney(lastTest.revenus);
    document.getElementById('stat-dep-ess').textContent = formatMoney(lastTest.depensesEssentielles);
    document.getElementById('stat-dep-non-ess').textContent = formatMoney(lastTest.depensesNonEssentielles);
    document.getElementById('stat-reste').textContent = formatMoney(lastTest.resteAVivre);
    document.getElementById('score-display').textContent = lastTest.score || '‚Äî';
    document.getElementById('test-title').textContent = 'Score: ' + (lastTest.score || '‚Äî') + '/100';
    document.getElementById('test-date').textContent = lastTest.date ? new Date(lastTest.date).toLocaleDateString('fr-FR') : '';
    
    if (plan !== 'free') {
      document.getElementById('stat-epargne').textContent = formatMoney(savingsGoal.epargne);
      var totalFuites = subscriptions.reduce(function(a, b) { return a + (b.montant || 0); }, 0) + gambling;
      document.getElementById('stat-fuites').textContent = formatMoney(totalFuites);
      document.getElementById('stat-score').textContent = (lastTest.score || 0) + '/100';
    }
  }

  // Historique
  document.getElementById('historique-count').textContent = tests.length + ' test' + (tests.length > 1 ? 's' : '');
  if (tests.length > 0) {
    var html = '<div style="overflow-x:auto"><table style="width:100%;border-collapse:collapse;font-size:14px"><thead><tr style="border-bottom:2px solid #e5e7eb"><th style="text-align:left;padding:8px">Date</th><th style="text-align:right;padding:8px">Revenus</th><th style="text-align:right;padding:8px">Reste</th><th style="text-align:center;padding:8px">Score</th></tr></thead><tbody>';
    tests.slice().reverse().forEach(function(t) {
      html += '<tr style="border-bottom:1px solid #f3f4f6"><td style="padding:8px">' + new Date(t.date).toLocaleDateString('fr-FR') + '</td><td style="text-align:right;padding:8px">' + formatMoney(t.revenus) + '</td><td style="text-align:right;padding:8px;color:#0d9f6f;font-weight:600">' + formatMoney(t.resteAVivre) + '</td><td style="text-align:center;padding:8px"><span class="badge">' + (t.score || '‚Äî') + '</span></td></tr>';
    });
    html += '</tbody></table></div>';
    document.getElementById('historique-list').innerHTML = html;
  }

  // √âpargne
  var pct = savingsGoal.objectif > 0 ? Math.round((savingsGoal.epargne / savingsGoal.objectif) * 100) : 0;
  var restant = Math.max(0, savingsGoal.objectif - savingsGoal.epargne);
  document.getElementById('objectif-montant').textContent = formatMoney(savingsGoal.objectif);
  document.getElementById('epargne-actuelle').textContent = formatMoney(savingsGoal.epargne);
  document.getElementById('epargne-restante').textContent = formatMoney(restant);
  document.getElementById('epargne-mensuelle').textContent = formatMoney(restant > 0 ? Math.ceil(restant / 12) : 0);
  document.getElementById('progress-fill').style.width = Math.min(100, pct) + '%';

  // Fuites
  if (subscriptions.length > 0) {
    var subsHtml = '';
    subscriptions.forEach(function(s, i) {
      subsHtml += '<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f3f4f6"><span>' + s.nom + '</span><span><strong>' + formatMoney(s.montant) + '</strong> <button onclick="deleteAbo(' + i + ')" style="background:none;border:none;color:#dc2626;cursor:pointer">‚úï</button></span></div>';
    });
    document.getElementById('subscriptions-list').innerHTML = subsHtml;
  }
  document.getElementById('gambling-amount').textContent = formatMoney(gambling);
  var totalFuites = subscriptions.reduce(function(a, b) { return a + (b.montant || 0); }, 0) + gambling;
  document.getElementById('total-fuites').textContent = formatMoney(totalFuites) + '/mois';
}

// Actions
function saveVersement() {
  var m = parseFloat(document.getElementById('versement-montant').value) || 0;
  if (m <= 0) { alert('Montant invalide'); return; }
  var g = getData('savingsGoal', { objectif: 0, epargne: 0 });
  g.epargne = (g.epargne || 0) + m;
  setData('savingsGoal', g);
  document.getElementById('versement-montant').value = '';
  closeModal('modal-versement');
  initDashboard();
}

function saveObjectif() {
  var o = parseFloat(document.getElementById('objectif-input').value) || 0;
  var e = parseFloat(document.getElementById('epargne-input').value) || 0;
  setData('savingsGoal', { objectif: o, epargne: e });
  closeModal('modal-objectif');
  initDashboard();
}

function saveAbonnement() {
  var n = document.getElementById('abo-nom').value.trim();
  var m = parseFloat(document.getElementById('abo-montant').value) || 0;
  if (!n || m <= 0) { alert('Champs invalides'); return; }
  var subs = getData('subscriptions', []);
  subs.push({ nom: n, montant: m });
  setData('subscriptions', subs);
  document.getElementById('abo-nom').value = '';
  document.getElementById('abo-montant').value = '';
  closeModal('modal-abonnement');
  initDashboard();
}

function deleteAbo(i) {
  var subs = getData('subscriptions', []);
  subs.splice(i, 1);
  setData('subscriptions', subs);
  initDashboard();
}

function saveJeux() {
  var m = parseFloat(document.getElementById('jeux-montant').value) || 0;
  setData('gambling', m);
  closeModal('modal-jeux');
  initDashboard();
}

function comparerChoix() {
  var coutA = parseFloat(document.getElementById('choix-a-cout').value) || 0;
  var dureeA = parseInt(document.getElementById('choix-a-duree').value) || 1;
  var coutB = parseFloat(document.getElementById('choix-b-cout').value) || 0;
  var dureeB = parseInt(document.getElementById('choix-b-duree').value) || 1;
  var totalA = coutA * dureeA;
  var totalB = coutB * dureeB;
  var diff = Math.abs(totalA - totalB);
  var nomA = document.getElementById('choix-a-nom').value || 'Choix A';
  var nomB = document.getElementById('choix-b-nom').value || 'Choix B';
  
  var html = '<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">';
  html += '<div style="text-align:center;padding:16px;background:#fff;border-radius:8px"><div style="font-size:12px;color:#6b7280">Total ' + nomA + '</div><div style="font-size:24px;font-weight:700;color:#0d9f6f">' + formatMoney(totalA) + '</div></div>';
  html += '<div style="text-align:center;padding:16px;background:#fff;border-radius:8px"><div style="font-size:12px;color:#6b7280">Total ' + nomB + '</div><div style="font-size:24px;font-weight:700;color:#3b82f6">' + formatMoney(totalB) + '</div></div>';
  html += '</div>';
  html += '<div style="text-align:center;padding:16px;background:#fff;border-radius:8px"><div style="font-size:12px;color:#6b7280">Diff√©rence</div><div style="font-size:28px;font-weight:700">' + formatMoney(diff) + '</div>';
  if (totalA < totalB) html += '<div style="color:#0d9f6f;font-weight:600;margin-top:8px">‚úÖ ' + nomA + ' est moins cher</div>';
  else if (totalB < totalA) html += '<div style="color:#3b82f6;font-weight:600;margin-top:8px">‚úÖ ' + nomB + ' est moins cher</div>';
  else html += '<div style="color:#6b7280;margin-top:8px">Les deux options co√ªtent le m√™me prix</div>';
  html += '</div>';
  
  document.getElementById('compare-text').innerHTML = html;
  document.getElementById('compare-result').style.display = 'block';
}

function simulerImprevu() {
  var lastTest = getData('lastTest', null);
  if (!lastTest) { alert('Faites d\'abord un test budg√©taire'); return; }
  
  var montant = parseFloat(document.getElementById('imprevu-montant').value) || 0;
  var mois = parseInt(document.getElementById('imprevu-mois').value) || 1;
  if (montant <= 0) { alert('Montant invalide'); return; }
  
  var resteActuel = lastTest.resteAVivre || 0;
  var coutMensuel = montant / mois;
  var nouveauReste = resteActuel - coutMensuel;
  
  var status, color, icon, message;
  if (nouveauReste >= resteActuel * 0.5) {
    status = 'success'; color = '#0d9f6f'; icon = '‚úÖ';
    message = 'Votre budget peut absorber cet impr√©vu sans probl√®me.';
  } else if (nouveauReste >= 0) {
    status = 'warning'; color = '#f59e0b'; icon = '‚ö†Ô∏è';
    message = 'Votre budget sera tendu mais g√©rable.';
  } else {
    status = 'danger'; color = '#dc2626'; icon = '‚ùå';
    message = 'Cet impr√©vu d√©passe votre capacit√© budg√©taire actuelle.';
  }
  
  var html = '<div style="background:' + (status === 'danger' ? 'rgba(220,38,38,.1)' : status === 'warning' ? 'rgba(245,158,11,.1)' : 'rgba(13,159,111,.1)') + ';padding:20px;border-radius:12px;border:1px solid ' + color + '">';
  html += '<div style="display:flex;align-items:center;gap:12px;margin-bottom:16px"><span style="font-size:32px">' + icon + '</span><div><div style="font-weight:700;font-size:18px">' + (status === 'success' ? 'Budget absorbable' : status === 'warning' ? 'Tension financi√®re' : 'Situation critique') + '</div><div style="color:#6b7280">' + message + '</div></div></div>';
  html += '<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;text-align:center">';
  html += '<div style="background:#fff;padding:12px;border-radius:8px"><div style="font-size:11px;color:#6b7280">Reste actuel</div><div style="font-size:18px;font-weight:700">' + formatMoney(resteActuel) + '</div></div>';
  html += '<div style="background:#fff;padding:12px;border-radius:8px"><div style="font-size:11px;color:#6b7280">Co√ªt/mois</div><div style="font-size:18px;font-weight:700;color:#dc2626">-' + formatMoney(coutMensuel) + '</div></div>';
  html += '<div style="background:#fff;padding:12px;border-radius:8px"><div style="font-size:11px;color:#6b7280">Nouveau reste</div><div style="font-size:18px;font-weight:700;color:' + (nouveauReste >= 0 ? '#0d9f6f' : '#dc2626') + '">' + formatMoney(nouveauReste) + '</div></div>';
  html += '</div></div>';
  
  document.getElementById('simulator-result').innerHTML = html;
  document.getElementById('simulator-result').style.display = 'block';
}

// Event Listeners
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM ready');
  initDashboard();
  
  // Menu principal
  document.querySelectorAll('.sidebar-link[data-section]').forEach(function(btn) {
    btn.addEventListener('click', function() {
      showSection(this.getAttribute('data-section'));
    });
  });
  
  // Actions rapides
  document.querySelectorAll('.action-btn[data-section]').forEach(function(btn) {
    btn.addEventListener('click', function() {
      showSection(this.getAttribute('data-section'));
    });
  });
  
  // Boutons modals
  var btnVersement = document.getElementById('btn-versement');
  var btnObjectif = document.getElementById('btn-objectif');
  var btnAbonnement = document.getElementById('btn-abonnement');
  var btnJeux = document.getElementById('btn-jeux');
  var btnComparer = document.getElementById('btn-comparer');
  var btnSimuler = document.getElementById('btn-simuler');
  
  if (btnVersement) btnVersement.addEventListener('click', function() { openModal('modal-versement'); });
  if (btnObjectif) btnObjectif.addEventListener('click', function() { openModal('modal-objectif'); });
  if (btnAbonnement) btnAbonnement.addEventListener('click', function() { openModal('modal-abonnement'); });
  if (btnJeux) btnJeux.addEventListener('click', function() { openModal('modal-jeux'); });
  if (btnComparer) btnComparer.addEventListener('click', comparerChoix);
  if (btnSimuler) btnSimuler.addEventListener('click', simulerImprevu);
  
  // Save buttons
  var btnSaveVersement = document.getElementById('btn-save-versement');
  var btnSaveObjectif = document.getElementById('btn-save-objectif');
  var btnSaveAbonnement = document.getElementById('btn-save-abonnement');
  var btnSaveJeux = document.getElementById('btn-save-jeux');
  
  if (btnSaveVersement) btnSaveVersement.addEventListener('click', saveVersement);
  if (btnSaveObjectif) btnSaveObjectif.addEventListener('click', saveObjectif);
  if (btnSaveAbonnement) btnSaveAbonnement.addEventListener('click', saveAbonnement);
  if (btnSaveJeux) btnSaveJeux.addEventListener('click', saveJeux);
  
  // Close buttons
  document.querySelectorAll('[data-close]').forEach(function(btn) {
    btn.addEventListener('click', function() {
      closeModal(this.getAttribute('data-close'));
    });
  });
  
  // Modal backdrop click
  document.querySelectorAll('.modal').forEach(function(modal) {
    modal.addEventListener('click', function(e) {
      if (e.target === this) closeModal(this.id);
    });
  });
  
  console.log('Event listeners attached');
});
</script>
</body>
</html>
radius:8px"><div style="font-size:11px;color:var(--text-muted)">Co√ªt/mois</div><div style="font-size:20px;font-weight:700;color:var(--danger)">-' + formatMoney(coutMensuel) + '</div></div>';
    html += '<div style="text-align:center;padding:16px;background:#fff;border-radius:8px"><div style="font-size:11px;color:var(--text-muted)">Nouveau reste</div><div style="font-size:20px;font-weight:700;color:' + (nouveauReste >= 0 ? 'var(--accent)' : 'var(--danger)') + '">' + formatMoney(nouveauReste) + '</div></div>';
    html += '</div></div>';

    document.getElementById('simulator-result').innerHTML = html;
    document.getElementById('simulator-result').style.display = '';
  }

  // === INIT ===
  function init() {
    console.log('Dashboard init');

    // Navigation sidebar
    document.querySelectorAll('.sidebar-link[data-section]').forEach(function(btn) {
      btn.addEventListener('click', function() {
        showSection(this.getAttribute('data-section'));
      });
    });

    // Modals close
    document.querySelectorAll('[data-close]').forEach(function(btn) {
      btn.addEventListener('click', function() {
        closeModal(this.getAttribute('data-close'));
      });
    });

    // Modal backdrop
    document.querySelectorAll('.modal').forEach(function(modal) {
      modal.addEventListener('click', function(e) {
        if (e.target === this) closeModal(this.id);
      });
    });

    // Boutons √©pargne
    var btnAddEpargne = document.getElementById('btn-add-epargne');
    var btnEditObjectif = document.getElementById('btn-edit-objectif');
    var btnSaveEpargne = document.getElementById('btn-save-epargne');
    var btnSaveObjectif = document.getElementById('btn-save-objectif');

    if (btnAddEpargne) btnAddEpargne.addEventListener('click', function() { openModal('modal-epargne'); });
    if (btnEditObjectif) btnEditObjectif.addEventListener('click', function() { 
      document.getElementById('input-objectif').value = getData('savingsGoalTotal', 0) || '';
      document.getElementById('input-deja-epargne').value = getData('savingsTotalSaved', 0) || '';
      openModal('modal-objectif'); 
    });

    if (btnSaveEpargne) btnSaveEpargne.addEventListener('click', function() {
      var mois = parseFloat(document.getElementById('input-epargne-mois').value) || 0;
      var total = getData('savingsTotalSaved', 0);
      setData('savedThisMonth', mois);
      setData('savingsTotalSaved', total + mois);
      document.getElementById('input-epargne-mois').value = '';
      closeModal('modal-epargne');
      renderEpargne();
      renderResume();
    });

    if (btnSaveObjectif) btnSaveObjectif.addEventListener('click', function() {
      var objectif = parseFloat(document.getElementById('input-objectif').value) || 0;
      var deja = parseFloat(document.getElementById('input-deja-epargne').value) || 0;
      setData('savingsGoalTotal', objectif);
      setData('savingsTotalSaved', deja);
      closeModal('modal-objectif');
      renderEpargne();
      renderResume();
    });

    // Boutons fuites
    var btnAddAbo = document.getElementById('btn-add-abo');
    var btnEditJeux = document.getElementById('btn-edit-jeux');
    var btnSaveAbo = document.getElementById('btn-save-abo');
    var btnSaveJeux = document.getElementById('btn-save-jeux');

    if (btnAddAbo) btnAddAbo.addEventListener('click', function() { openModal('modal-abo'); });
    if (btnEditJeux) btnEditJeux.addEventListener('click', function() { 
      document.getElementById('input-jeux').value = getData('gambling', 0) || '';
      openModal('modal-jeux'); 
    });

    if (btnSaveAbo) btnSaveAbo.addEventListener('click', function() {
      var nom = document.getElementById('input-abo-nom').value.trim();
      var montant = parseFloat(document.getElementById('input-abo-montant').value) || 0;
      if (!nom || montant <= 0) { alert('Remplissez tous les champs'); return; }
      var subs = getData('subscriptions', []);
      subs.push({ nom: nom, montant: montant });
      setData('subscriptions', subs);
      document.getElementById('input-abo-nom').value = '';
      document.getElementById('input-abo-montant').value = '';
      closeModal('modal-abo');
      renderFuites();
      renderResume();
    });

    if (btnSaveJeux) btnSaveJeux.addEventListener('click', function() {
      var montant = parseFloat(document.getElementById('input-jeux').value) || 0;
      setData('gambling', montant);
      closeModal('modal-jeux');
      renderFuites();
      renderResume();
    });

    // Comparateur
    var btnComparer = document.getElementById('btn-comparer');
    if (btnComparer) btnComparer.addEventListener('click', comparer);

    // Simulateur
    var btnSimuler = document.getElementById('btn-simuler');
    if (btnSimuler) btnSimuler.addEventListener('click', simuler);

    // Rappels
    var btnSaveRappel = document.getElementById('btn-save-rappel');
    if (btnSaveRappel) btnSaveRappel.addEventListener('click', function() {
      var actif = document.getElementById('rappel-actif').checked;
      var email = document.getElementById('rappel-email').value.trim();
      setData('rappelConfig', { actif: actif, email: email });
      alert('Configuration enregistr√©e !');
    });

    // Render
    renderQuickActions();
    renderResume();
    renderHistorique();
    if (hasFeature('epargne')) renderEpargne();
    if (hasFeature('fuites')) renderFuites();

    console.log('Dashboard ready');
  }

  // Exposer showSection globalement
  window.showSection = showSection;

  // Start
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>

</body>
</html>
radius:8px"><div style="font-size:11px;color:var(--text-muted)">Co√ªt/mois</div><div style="font-size:20px;font-weight:700;color:var(--danger)">-' + formatMoney(coutMensuel) + '</div></div>';
    html += '<div style="text-align:center;padding:16px;background:#fff;border-radius:8px"><div style="font-size:11px;color:var(--text-muted)">Nouveau reste</div><div style="font-size:20px;font-weight:700;color:' + (nouveauReste >= 0 ? 'var(--accent)' : 'var(--danger)') + '">' + formatMoney(nouveauReste) + '</div></div>';
    html += '</div></div>';

    document.getElementById('simulator-result').innerHTML = html;
    document.getElementById('simulator-result').style.display = '';
  }

  // === INITIALISATION ===
  function init() {
    console.log('Dashboard init');

    // V√©rifier connexion
    try {
      var session = JSON.parse(localStorage.getItem('auth_session_v1'));
      if (!session || !session.email) {
        window.location.replace('login.html');
        return;
      }
    } catch(e) {
      window.location.replace('login.html');
      return;
    }

    // Render initial
    renderQuickActions();
    renderResume();
    renderHistorique();
    renderEpargne();
    renderFuites();

    // Navigation sidebar
    document.querySelectorAll('.sidebar-link[data-section]').forEach(function(btn) {
      btn.addEventListener('click', function() {
        showSection(this.getAttribute('data-section'));
      });
    });

    // Boutons √©pargne
    var btnAddEpargne = document.getElementById('btn-add-epargne');
    var btnEditObjectif = document.getElementById('btn-edit-objectif');
    if (btnAddEpargne) btnAddEpargne.addEventListener('click', function() { openModal('modal-epargne'); });
    if (btnEditObjectif) btnEditObjectif.addEventListener('click', function() { openModal('modal-objectif'); });

    // Save √©pargne
    var btnSaveEpargne = document.getElementById('btn-save-epargne');
    if (btnSaveEpargne) {
      btnSaveEpargne.addEventListener('click', function() {
        var montant = parseFloat(document.getElementById('input-epargne-mois').value) || 0;
        var total = getData('savingsTotalSaved', 0);
        setData('savedThisMonth', montant);
        setData('savingsTotalSaved', total + montant);
        closeModal('modal-epargne');
        renderEpargne();
        renderResume();
      });
    }

    // Save objectif
    var btnSaveObjectif = document.getElementById('btn-save-objectif');
    if (btnSaveObjectif) {
      btnSaveObjectif.addEventListener('click', function() {
        var objectif = parseFloat(document.getElementById('input-objectif').value) || 0;
        var deja = parseFloat(document.getElementById('input-deja-epargne').value) || 0;
        setData('savingsGoalTotal', objectif);
        setData('savingsTotalSaved', deja);
        closeModal('modal-objectif');
        renderEpargne();
        renderResume();
      });
    }

    // Boutons fuites
    var btnAddAbo = document.getElementById('btn-add-abo');
    var btnEditJeux = document.getElementById('btn-edit-jeux');
    if (btnAddAbo) btnAddAbo.addEventListener('click', function() { openModal('modal-abo'); });
    if (btnEditJeux) btnEditJeux.addEventListener('click', function() { openModal('modal-jeux'); });

    // Save abonnement
    var btnSaveAbo = document.getElementById('btn-save-abo');
    if (btnSaveAbo) {
      btnSaveAbo.addEventListener('click', function() {
        var nom = document.getElementById('input-abo-nom').value.trim();
        var montant = parseFloat(document.getElementById('input-abo-montant').value) || 0;
        if (!nom || montant <= 0) { alert('Champs invalides'); return; }
        var subs = getData('subscriptions', []);
        subs.push({ nom: nom, montant: montant });
        setData('subscriptions', subs);
        document.getElementById('input-abo-nom').value = '';
        document.getElementById('input-abo-montant').value = '';
        closeModal('modal-abo');
        renderFuites();
        renderResume();
      });
    }

    // Save jeux
    var btnSaveJeux = document.getElementById('btn-save-jeux');
    if (btnSaveJeux) {
      btnSaveJeux.addEventListener('click', function() {
        var montant = parseFloat(document.getElementById('input-jeux').value) || 0;
        setData('gambling', montant);
        closeModal('modal-jeux');
        renderFuites();
        renderResume();
      });
    }

    // Comparateur
    var btnComparer = document.getElementById('btn-comparer');
    if (btnComparer) btnComparer.addEventListener('click', comparer);

    // Simulateur
    var btnSimuler = document.getElementById('btn-simuler');
    if (btnSimuler) btnSimuler.addEventListener('click', simuler);

    // Rappels
    var btnSaveRappel = document.getElementById('btn-save-rappel');
    if (btnSaveRappel) {
      btnSaveRappel.addEventListener('click', function() {
        alert('Fonctionnalit√© bient√¥t disponible !');
      });
    }

    // Fermer modals
    document.querySelectorAll('[data-close]').forEach(function(btn) {
      btn.addEventListener('click', function() {
        closeModal(this.getAttribute('data-close'));
      });
    });

    // Clic sur fond modal
    document.querySelectorAll('.modal').forEach(function(modal) {
      modal.addEventListener('click', function(e) {
        if (e.target === this) closeModal(this.id);
      });
    });

    console.log('Dashboard ready');
  }

  // Exposer showSection globalement
  window.showSection = showSection;

  // D√©marrer
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>

</body>
</html>