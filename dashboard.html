<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard â€“ OÃ¹ part mon argent ?</title>
  <link rel="stylesheet" href="css/style.css?v=2">
  
  <!-- PROTECTION : Redirection si non connectÃ© (exÃ©cutÃ© AVANT le rendu) -->
  <script>
    (function() {
      try {
        var s = JSON.parse(localStorage.getItem("auth_session_v1"));
        if (!(s && s.email)) {
          document.documentElement.style.display = 'none';
          window.location.replace('login.html');
        }
      } catch(e) {
        document.documentElement.style.display = 'none';
        window.location.replace('login.html');
      }
    })();
  </script>
  <style>
    .main { max-width: 1100px; margin: 0 auto; padding: var(--space-xl); }
    .page-header { text-align: center; margin-bottom: var(--space-xl); }
    .page-title { font-size: var(--text-3xl); margin-bottom: var(--space-xs); }
    .page-subtitle { color: var(--text-muted); }
    .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-md); }
    .section { margin-top: var(--space-xl); }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-sm); }
    .card-label { font-size: var(--text-xs); text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); font-weight: 600; }
    .card-icon { width: 32px; height: 32px; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; font-size: 16px; }
    .card-icon.green { background: rgba(13,159,111,0.1); }
    .card-icon.red { background: rgba(220,38,38,0.1); }
    .card-icon.orange { background: rgba(245,158,11,0.1); }
    .card-value { font-size: var(--text-2xl); font-weight: 700; color: var(--text-primary); }
    .badge { font-size: 11px; font-weight: 600; padding: 4px 10px; border-radius: var(--radius-full); }
    .badge.success { background: rgba(13,159,111,0.1); color: var(--accent); }
    .badge.warning { background: rgba(245,158,11,0.1); color: #d97706; }
    .badge.danger { background: rgba(220,38,38,0.1); color: #dc2626; }
    .badge.locked { background: var(--bg-subtle); color: var(--text-muted); }
    .plan-banner { background: var(--accent-subtle); border: 1px solid var(--accent-border); border-radius: var(--radius-lg); padding: var(--space-md) var(--space-lg); display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-xl); }
    .plan-info { display: flex; align-items: center; gap: var(--space-md); }
    .plan-label { font-size: var(--text-sm); color: var(--text-secondary); }
    .plan-name { font-weight: 700; color: var(--accent); font-size: var(--text-lg); }
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
    .modal-content { background: white; border-radius: var(--radius-xl); max-width: 400px; width: 90%; padding: var(--space-xl); }
    @media (max-width: 1024px) { .grid-4 { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 600px) { .grid-4 { grid-template-columns: 1fr; } .plan-banner { flex-direction: column; gap: var(--space-md); text-align: center; } }
  </style>
</head>
<body>
<header class="header">
  <div class="brand">
    <div class="logo">â‚¬</div>
    <div>
      <div class="brand-title">OÃ¹ part mon argent ?</div>
      <div class="brand-subtitle">Dashboard</div>
    </div>
  </div>
  <nav class="nav">
    <a class="nav-link" href="index.html">Accueil</a>
    <a class="nav-link" href="test.html">Test gratuit</a>
    <a class="nav-link" href="tarifs.html">Tarifs</a>
    <a class="nav-link" href="login.html" data-auth="out">Connexion</a>
    <a class="nav-link active" href="dashboard.html" data-auth="in">Dashboard</a>
    <button class="btn-ghost" type="button" data-auth="in" data-logout>DÃ©connexion</button>
  </nav>
</header>

<main class="main">
  <div class="plan-banner">
    <div class="plan-info">
      <span class="plan-label">Votre plan :</span>
      <span class="plan-name" id="user-plan">Gratuit</span>
    </div>
    <a href="tarifs.html" class="btn btn-primary">Voir les offres</a>
  </div>

  <div class="page-header">
    <h1 class="page-title">Tableau de bord</h1>
    <p class="page-subtitle">Bienvenue ! Voici le rÃ©sumÃ© de votre situation financiÃ¨re.</p>
  </div>

  <!-- A) RÃ©sumÃ© Financier -->
  <div class="grid-4">
    <div class="card">
      <div class="card-header"><span class="card-label">Revenus</span><div class="card-icon green">ğŸ’µ</div></div>
      <div class="card-value" id="revenus">â€”</div>
    </div>
    <div class="card">
      <div class="card-header"><span class="card-label">DÃ©penses essentielles</span><div class="card-icon red">ğŸ </div></div>
      <div class="card-value" id="depenses-essentielles">â€”</div>
    </div>
    <div class="card">
      <div class="card-header"><span class="card-label">DÃ©penses non essentielles</span><div class="card-icon orange">ğŸ›ï¸</div></div>
      <div class="card-value" id="depenses-non-essentielles">â€”</div>
    </div>
    <div class="card">
      <div class="card-header"><span class="card-label">Reste Ã  vivre</span><div class="card-icon green">âœ¨</div></div>
      <div class="card-value" id="reste-a-vivre">â€”</div>
    </div>
  </div>

  <div class="card callout mt-lg" id="no-test-message" style="display: none; text-align: center;">
    <h2>Pas encore de test</h2>
    <p>Faites votre premier test pour voir votre rÃ©sumÃ© financier.</p>
    <div class="cta-row" style="margin-top: var(--space-md);"><a href="test.html" class="btn btn-primary">Faire un test</a></div>
  </div>

  <!-- B) Dernier Test + C) Ã‰pargne -->
  <div class="section">
    <div class="grid-2">
      <div class="card">
        <div class="card-header"><h3>ğŸ¯ Dernier test financier</h3><span class="badge success" id="test-badge">â€”</span></div>
        <div style="margin: var(--space-lg) 0; display: flex; align-items: center; gap: var(--space-lg);">
          <div style="position: relative; width: 80px; height: 80px;">
            <svg width="80" height="80" viewBox="0 0 80 80">
              <circle cx="40" cy="40" r="35" fill="none" stroke="var(--border-light)" stroke-width="6"/>
              <circle id="score-circle" cx="40" cy="40" r="35" fill="none" stroke="var(--accent)" stroke-width="6" stroke-dasharray="220" stroke-dashoffset="220" stroke-linecap="round" transform="rotate(-90 40 40)" style="transition: stroke-dashoffset 1s ease;"/>
            </svg>
            <div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;">
              <span style="font-size: var(--text-xl); font-weight: 700;" id="score-value">â€”</span>
            </div>
          </div>
          <div>
            <h4 id="test-title" style="margin-bottom: 4px;">â€”</h4>
            <p id="test-description" style="font-size: var(--text-sm);">â€”</p>
            <span style="font-size: var(--text-xs); color: var(--text-muted);" id="test-date">Dernier test : â€”</span>
          </div>
        </div>
        <div class="cta-row" style="justify-content: flex-start;">
          <a href="test.html" class="btn btn-primary">ğŸ”„ Refaire un test</a>
          <button class="btn btn-secondary" onclick="openHistorique()">ğŸ“Š Historique</button>
        </div>
      </div>

      <div class="card">
        <div class="card-header"><h3>ğŸ’ Objectif d'Ã©pargne</h3><span class="badge" id="savings-badge">â€”</span></div>
        <div id="epargne-content">
          <div style="text-align: center; margin: var(--space-md) 0;">
            <span style="font-size: var(--text-xs); color: var(--text-muted); text-transform: uppercase;">Objectif total</span>
            <div style="font-size: var(--text-2xl); font-weight: 700;" id="objectif-montant">0 â‚¬</div>
          </div>
          <div style="margin: var(--space-md) 0;">
            <div style="display: flex; justify-content: space-between; font-size: var(--text-sm); margin-bottom: 6px;">
              <span>Progression</span><span id="progress-percent">0%</span>
            </div>
            <div style="height: 8px; background: var(--bg-subtle); border-radius: var(--radius-full); overflow: hidden;">
              <div id="progress-fill" style="height: 100%; background: var(--accent); width: 0%; transition: width 1s ease;"></div>
            </div>
          </div>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-sm); text-align: center; margin: var(--space-lg) 0;">
            <div><div style="font-size: var(--text-lg); font-weight: 700; color: var(--accent);" id="epargne-actuelle">0 â‚¬</div><div style="font-size: var(--text-xs); color: var(--text-muted);">Ã‰pargnÃ©</div></div>
            <div><div style="font-size: var(--text-lg); font-weight: 700; color: #d97706;" id="epargne-restante">0 â‚¬</div><div style="font-size: var(--text-xs); color: var(--text-muted);">Restant</div></div>
            <div><div style="font-size: var(--text-lg); font-weight: 700;" id="epargne-mensuelle">0 â‚¬</div><div style="font-size: var(--text-xs); color: var(--text-muted);">ConseillÃ©/mois</div></div>
          </div>
          <div class="cta-row" style="justify-content: flex-start;">
            <button class="btn btn-primary" onclick="ajouterVersement()">â• Versement</button>
            <button class="btn btn-secondary" onclick="modifierObjectif()">âš™ï¸ Modifier</button>
          </div>
        </div>
        <div id="epargne-locked" style="display: none; text-align: center; padding: var(--space-lg);">
          <div style="font-size: 48px;">ğŸ”’</div>
          <h4>FonctionnalitÃ© Premium</h4>
          <p style="font-size: var(--text-sm);">Disponible avec le plan Essentiel ou Complet.</p>
          <a href="tarifs.html" class="btn btn-primary" style="margin-top: var(--space-md);">Voir les offres</a>
        </div>
      </div>
    </div>
  </div>

  <!-- E) Fuites -->
  <div class="section">
    <div class="card">
      <div class="card-header"><h3>ğŸ’¸ Fuites : abonnements & jeux</h3><span class="badge" id="fuites-badge">â€”</span></div>
      <div id="fuites-content">
        <p style="font-size: var(--text-sm); color: var(--text-muted); margin-bottom: var(--space-md);">Identifiez vos dÃ©penses invisibles.</p>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg);">
          <div>
            <h4 style="font-size: var(--text-sm); margin-bottom: var(--space-sm);">ğŸ“º Abonnements</h4>
            <ul class="list" id="subscriptions-list"><li>Aucun abonnement</li></ul>
            <button class="btn btn-secondary" style="margin-top: var(--space-sm);" onclick="ajouterAbonnement()">+ Ajouter</button>
          </div>
          <div>
            <h4 style="font-size: var(--text-sm); margin-bottom: var(--space-sm);">ğŸ° Jeux d'argent</h4>
            <div style="background: var(--bg-subtle); padding: var(--space-md); border-radius: var(--radius-md);">
              <div style="font-size: var(--text-2xl); font-weight: 700;" id="gambling-amount">0 â‚¬</div>
              <div style="font-size: var(--text-xs); color: var(--text-muted);">par mois</div>
            </div>
            <button class="btn btn-secondary" style="margin-top: var(--space-sm);" onclick="modifierJeux()">Modifier</button>
          </div>
        </div>
        <div style="margin-top: var(--space-lg); padding: var(--space-md); background: rgba(220,38,38,0.05); border-radius: var(--radius-md); border: 1px solid rgba(220,38,38,0.2); display: flex; justify-content: space-between; align-items: center;">
          <span style="font-weight: 600; color: #dc2626;">ğŸ’° Total fuites</span>
          <span style="font-size: var(--text-xl); font-weight: 700; color: #dc2626;" id="total-fuites">0 â‚¬</span>
        </div>
      </div>
      <div id="fuites-locked" style="display: none; text-align: center; padding: var(--space-lg);">
        <div style="font-size: 48px;">ğŸ”’</div>
        <h4>FonctionnalitÃ© Premium</h4>
        <a href="tarifs.html" class="btn btn-primary" style="margin-top: var(--space-md);">Voir les offres</a>
      </div>
    </div>
  </div>

  <!-- F) Rappels -->
  <div class="section">
    <div class="card">
      <div class="card-header"><h3>ğŸ“§ Rappels email</h3><span class="badge" id="rappels-badge">â€”</span></div>
      <div id="rappels-content">
        <div style="display: flex; align-items: center; gap: var(--space-lg); flex-wrap: wrap;">
          <label style="display: flex; align-items: center; gap: var(--space-sm); cursor: pointer;">
            <input type="checkbox" id="rappel-toggle" style="width: 18px; height: 18px;">
            <span>Rappel hebdomadaire</span>
          </label>
          <div class="field" style="flex: 1; min-width: 200px;">
            <label for="rappel-email">Email</label>
            <input type="email" id="rappel-email" placeholder="votre@email.com">
          </div>
          <button class="btn btn-primary" onclick="saveRappel()">Enregistrer</button>
        </div>
        <div class="hint" style="margin-top: var(--space-md);">â„¹ï¸ FonctionnalitÃ© bientÃ´t disponible.</div>
      </div>
      <div id="rappels-locked" style="display: none; text-align: center; padding: var(--space-lg);">
        <div style="font-size: 48px;">ğŸ”’</div>
        <h4>FonctionnalitÃ© Premium</h4>
        <a href="tarifs.html" class="btn btn-primary" style="margin-top: var(--space-md);">Voir les offres</a>
      </div>
    </div>
  </div>

  <!-- D) Historique -->
  <div class="section">
    <div class="card">
      <div class="card-header"><h3>ğŸ“‹ Historique des tests</h3><span class="badge" id="historique-count">0 tests</span></div>
      <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; font-size: var(--text-sm);">
          <thead>
            <tr style="border-bottom: 2px solid var(--border-light);">
              <th style="text-align: left; padding: var(--space-sm); color: var(--text-muted);">Date</th>
              <th style="text-align: right; padding: var(--space-sm); color: var(--text-muted);">Revenus</th>
              <th style="text-align: right; padding: var(--space-sm); color: var(--text-muted);">DÃ©penses</th>
              <th style="text-align: right; padding: var(--space-sm); color: var(--text-muted);">Reste</th>
              <th style="text-align: center; padding: var(--space-sm); color: var(--text-muted);">Score</th>
              <th style="padding: var(--space-sm);"></th>
            </tr>
          </thead>
          <tbody id="historique-table"><tr><td colspan="6" style="text-align: center; padding: var(--space-lg); color: var(--text-muted);">Aucun test</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>
</main>

<!-- MODALS -->
<div id="modal-historique" class="modal"><div class="modal-content" style="max-width: 800px;"><div style="display: flex; justify-content: space-between; margin-bottom: var(--space-lg);"><h2>ğŸ“Š Historique</h2><button onclick="closeHistorique()" style="background: none; border: none; font-size: 24px; cursor: pointer;">Ã—</button></div><div id="modal-historique-content"></div></div></div>
<div id="modal-versement" class="modal"><div class="modal-content"><h2 style="margin-bottom: var(--space-lg);">â• Versement</h2><div class="field"><label>Montant (â‚¬)</label><input type="number" id="versement-montant" placeholder="100"></div><div class="cta-row" style="margin-top: var(--space-lg);"><button class="btn btn-primary" onclick="saveVersement()">Ajouter</button><button class="btn btn-secondary" onclick="closeVersement()">Annuler</button></div></div></div>
<div id="modal-objectif" class="modal"><div class="modal-content"><h2 style="margin-bottom: var(--space-lg);">âš™ï¸ Objectif</h2><div class="field" style="margin-bottom: var(--space-md);"><label>Objectif (â‚¬)</label><input type="number" id="objectif-input" placeholder="15000"></div><div class="field"><label>Ã‰pargne actuelle (â‚¬)</label><input type="number" id="epargne-input" placeholder="3000"></div><div class="cta-row" style="margin-top: var(--space-lg);"><button class="btn btn-primary" onclick="saveObjectif()">Enregistrer</button><button class="btn btn-secondary" onclick="closeObjectif()">Annuler</button></div></div></div>
<div id="modal-abonnement" class="modal"><div class="modal-content"><h2 style="margin-bottom: var(--space-lg);">ğŸ“º Abonnement</h2><div class="field" style="margin-bottom: var(--space-md);"><label>Nom</label><input type="text" id="abo-nom" placeholder="Netflix..."></div><div class="field"><label>Montant (â‚¬)</label><input type="number" id="abo-montant" placeholder="15.99" step="0.01"></div><div class="cta-row" style="margin-top: var(--space-lg);"><button class="btn btn-primary" onclick="saveAbonnement()">Ajouter</button><button class="btn btn-secondary" onclick="closeAbonnement()">Annuler</button></div></div></div>
<div id="modal-jeux" class="modal"><div class="modal-content"><h2 style="margin-bottom: var(--space-lg);">ğŸ° Jeux d'argent</h2><div class="field"><label>Montant mensuel (â‚¬)</label><input type="number" id="jeux-montant" placeholder="50"></div><div class="cta-row" style="margin-top: var(--space-lg);"><button class="btn btn-primary" onclick="saveJeux()">Enregistrer</button><button class="btn btn-secondary" onclick="closeJeux()">Annuler</button></div></div></div>

<footer class="footer"><a href="tarifs.html">Tarifs</a> Â· <a href="index.html">Accueil</a> Â· <span class="muted">Â© <span id="year"></span> OÃ¹ part mon argent</span></footer>

<script src="assets/nav-auth.js"></script>
<script src="js/dashboard.js"></script>
</body>
</html>
