<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Dashboard ‚Äî O√π part mon argent ?</title>

  <!-- CSS GLOBAL DU SITE -->
  <link rel="stylesheet" href="/css/style.css?v=999">
</head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard | O√π part mon argent ?</title>

 
</head>
<body>
  <!-- ========================================
       HEADER / NAVIGATION
  ======================================== -->
  <header class="header">
    <div class="header-container">
      <a href="/index.html" class="logo">en attente</a>

      <button class="menu-toggle" type="button"
              onclick="toggleMenu()"
              aria-label="Ouvrir le menu"
              aria-controls="nav"
              aria-expanded="false">
        <span></span><span></span><span></span>
      </button>

      <!-- ‚úÖ NAV corrig√©e (id="nav", class="nav", classes nav-link/nav-btn, data-auth OK) -->
      <nav id="nav" class="nav">
        <a class="nav-link" href="/index.html">Accueil</a>
        <a class="nav-link" href="/test.html">Test gratuit</a>
        <a class="nav-link" href="/tarifs.html">Tarifs</a>

        <!-- Visible seulement si d√©connect√© -->
        <a class="nav-link" href="/login.html" data-auth="logged-out">Connexion</a>

        <!-- Visible seulement si connect√© -->
        <a class="nav-link active" href="/dashboard.html" data-auth="logged-in">Dashboard</a>
        <a class="nav-btn outline" href="#" data-auth="logged-in" data-action="logout">D√©connexion</a>
      </nav>
    </div>
  </header>

  <!-- ========================================
       CONTENU PRINCIPAL
  ======================================== -->
  <main class="main">
    <div class="page-header">
      <h1 class="page-title">Tableau de bord</h1>
      <p class="page-subtitle">Bienvenue ! Voici le r√©sum√© de votre situation financi√®re.</p>
    </div>

    <!-- Section : R√©sum√© Financier -->
    <div class="grid-4">
      <div class="card">
        <div class="card-header">
          <span class="card-label">Revenus</span>
          <div class="card-icon green">üíµ</div>
        </div>
        <div class="card-value" id="revenus">0 ‚Ç¨</div>
        <div class="card-change positive"><span>‚Üë 5.2%</span> vs mois dernier</div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-label">D√©penses essentielles</span>
          <div class="card-icon red">üè†</div>
        </div>
        <div class="card-value" id="depenses-essentielles">0 ‚Ç¨</div>
        <div class="card-change negative"><span>‚Üë 2.1%</span> vs mois dernier</div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-label">D√©penses non essentielles</span>
          <div class="card-icon orange">üõçÔ∏è</div>
        </div>
        <div class="card-value" id="depenses-non-essentielles">0 ‚Ç¨</div>
        <div class="card-change positive"><span>‚Üì 8.4%</span> vs mois dernier</div>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-label">Reste √† vivre</span>
          <div class="card-icon green">‚ú®</div>
        </div>
        <div class="card-value" id="reste-a-vivre">0 ‚Ç¨</div>
        <div class="card-change positive"><span>‚Üë 12.3%</span> vs mois dernier</div>
      </div>
    </div>

    <!-- Sections Test + √âpargne -->
    <div class="section">
      <div class="grid-2">
        <!-- Section : Dernier Test -->
        <div class="card-large">
          <div class="card-large-header">
            <h3 class="card-large-title">üéØ Dernier test financier</h3>
            <span class="badge success" id="test-badge">Bonne sant√©</span>
          </div>

          <div class="test-content">
            <div class="test-score">
              <svg width="100" height="100" viewBox="0 0 100 100">
                <circle class="test-score-bg" cx="50" cy="50" r="40"></circle>
                <circle class="test-score-fill" id="score-circle" cx="50" cy="50" r="40"></circle>
              </svg>
              <div class="test-score-value">
                <strong id="score-value">0</strong>
                <span>/100</span>
              </div>
            </div>

            <div class="test-info">
              <h4 id="test-title">Bonne gestion budg√©taire</h4>
              <p id="test-description">
                Votre situation financi√®re est saine. Continuez √† √©pargner r√©guli√®rement pour atteindre vos objectifs.
              </p>
              <span class="test-date" id="test-date">Dernier test : --</span>
            </div>
          </div>

          <div class="btn-group">
            <a href="/test.html" class="btn btn-primary">üîÑ Refaire un test</a>
            <button class="btn btn-secondary" type="button">üìä Voir l'historique</button>
          </div>
        </div>

        <!-- Section : Objectif d'√âpargne -->
        <div class="card-large">
          <div class="card-large-header">
            <h3 class="card-large-title">üíé Objectif d'√©pargne</h3>
            <span class="badge warning" id="savings-badge">En cours</span>
          </div>

          <div class="savings-goal">
            <span class="savings-label">Objectif total</span>
            <div class="savings-amount" id="objectif-montant">0 ‚Ç¨</div>
          </div>

          <div class="progress-section">
            <div class="progress-header">
              <span class="progress-label">Progression</span>
              <span class="progress-value" id="progress-percent">0%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
          </div>

          <div class="savings-stats">
            <div class="savings-stat">
              <div class="savings-stat-value green" id="epargne-actuelle">0 ‚Ç¨</div>
              <div class="savings-stat-label">√âpargn√©</div>
            </div>
            <div class="savings-stat">
              <div class="savings-stat-value orange" id="epargne-restante">0 ‚Ç¨</div>
              <div class="savings-stat-label">Restant</div>
            </div>
            <div class="savings-stat">
              <div class="savings-stat-value" id="epargne-mensuelle">0 ‚Ç¨</div>
              <div class="savings-stat-label">Conseill√© / mois</div>
            </div>
          </div>

          <div class="btn-group">
            <button class="btn btn-primary" type="button">‚ûï Ajouter un versement</button>
            <button class="btn btn-secondary" type="button">‚öôÔ∏è Modifier</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Scripts -->
  <script src="/nav-auth.js"></script>

  <script>
    // ‚úÖ Protection : si pas connect√© -> login
    if (localStorage.getItem('auth') !== '1') {
      window.location.href = '/login.html';
    }

    // ============================================
    // DONN√âES EXEMPLES
    // ============================================
    const financialData = {
      revenus: 3850,
      depensesEssentielles: 1920,
      depensesNonEssentielles: 580,
      resteAVivre: 1350,
      objectifEpargne: 15000,
      epargneActuelle: 9750,
      epargneMensuelleConseillee: 450
    };

    const testData = {
      score: 78,
      date: '15 d√©cembre 2024',
      titre: 'Bonne gestion budg√©taire',
      description: 'Votre situation financi√®re est saine. Continuez √† √©pargner r√©guli√®rement pour atteindre vos objectifs.'
    };

    // ============================================
    // FONCTIONS UTILITAIRES
    // ============================================
    function formatMoney(amount) {
      return new Intl.NumberFormat('fr-FR', {
        style: 'currency',
        currency: 'EUR',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
      }).format(amount);
    }

    function animateValue(element, start, end, duration, formatter) {
      let startTime = null;

      function step(timestamp) {
        if (!startTime) startTime = timestamp;
        const progress = Math.min((timestamp - startTime) / duration, 1);
        const value = Math.floor(progress * (end - start) + start);
        element.textContent = formatter ? formatter(value) : value;

        if (progress < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    // ============================================
    // INITIALISATION
    // ============================================
    function initDashboard() {
      // Animer les valeurs financi√®res
      animateValue(document.getElementById('revenus'), 0, financialData.revenus, 800, formatMoney);
      animateValue(document.getElementById('depenses-essentielles'), 0, financialData.depensesEssentielles, 800, formatMoney);
      animateValue(document.getElementById('depenses-non-essentielles'), 0, financialData.depensesNonEssentielles, 800, formatMoney);
      animateValue(document.getElementById('reste-a-vivre'), 0, financialData.resteAVivre, 800, formatMoney);

      // Section Test
      initTestSection();

      // Section √âpargne
      initSavingsSection();

      // ‚úÖ Met √† jour la nav (au cas o√π)
      if (window.authManager && window.authManager.updateNavigation) {
        window.authManager.updateNavigation();
      }
    }

    function initTestSection() {
      // Score circulaire
      const circumference = 2 * Math.PI * 40;
      const offset = circumference - (testData.score / 100) * circumference;
      const scoreCircle = document.getElementById('score-circle');

      setTimeout(() => {
        scoreCircle.style.strokeDashoffset = offset;
      }, 200);

      animateValue(document.getElementById('score-value'), 0, testData.score, 1000);

      // Infos
      document.getElementById('test-title').textContent = testData.titre;
      document.getElementById('test-description').textContent = testData.description;
      document.getElementById('test-date').textContent = 'Dernier test : ' + testData.date;
    }

    function initSavingsSection() {
      const progressPercent = Math.round((financialData.epargneActuelle / financialData.objectifEpargne) * 100);
      const restant = financialData.objectifEpargne - financialData.epargneActuelle;

      document.getElementById('objectif-montant').textContent = formatMoney(financialData.objectifEpargne);

      animateValue(document.getElementById('epargne-actuelle'), 0, financialData.epargneActuelle, 800, formatMoney);
      document.getElementById('epargne-restante').textContent = formatMoney(restant);
      document.getElementById('epargne-mensuelle').textContent = formatMoney(financialData.epargneMensuelleConseillee);

      // Barre de progression
      setTimeout(() => {
        document.getElementById('progress-fill').style.width = progressPercent + '%';
      }, 200);

      animateValue(document.getElementById('progress-percent'), 0, progressPercent, 800, v => v + '%');
    }

    // ============================================
    // MENU MOBILE (corrig√©)
    // ============================================
    function toggleMenu() {
      const nav = document.getElementById('nav');
      const btn = document.querySelector('.menu-toggle');
      const isOpen = nav.classList.toggle('open');
      if (btn) btn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
    }

    // Fermer le menu si on clique √† l'ext√©rieur (mobile)
    document.addEventListener('click', (e) => {
      const nav = document.getElementById('nav');
      const btn = document.querySelector('.menu-toggle');
      if (!nav || !btn) return;

      const clickedInside = nav.contains(e.target) || btn.contains(e.target);
      if (!clickedInside && nav.classList.contains('open')) {
        nav.classList.remove('open');
        btn.setAttribute('aria-expanded', 'false');
      }
    });

    // D√©marrer
    document.addEventListener('DOMContentLoaded', initDashboard);
  </script>
</body>
</html>
